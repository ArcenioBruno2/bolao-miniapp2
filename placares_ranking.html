
<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üèÜ Ranking do Bol√£o</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #f59e0b; --primary-dark: #d97706; --gold: #ffc107; --silver: #c0c0c0; --bronze: #cd7f32;
            --gray-100: #f3f4f6; --gray-200: #e5e7eb; --gray-700: #374151; --gray-900: #111827;
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            --radius: 12px; --transition: all 0.3s ease;
        }
        body { font-family: system-ui, sans-serif; background: var(--gray-100); color: var(--gray-900); margin: 0; padding: 20px; }
        .container { max-width: 800px; margin: 0 auto; }
        .card { background: white; border-radius: var(--radius); padding: 25px; box-shadow: var(--shadow-lg); }
        .header { text-align: center; margin-bottom: 25px; border-bottom: 2px solid var(--primary); padding-bottom: 15px; }
        .header h1 { font-size: 2rem; color: var(--primary-dark); }
        .header p { color: var(--gray-700); }
        .ranking-table { width: 100%; border-collapse: collapse; }
        .ranking-table th, .ranking-table td { padding: 12px 15px; text-align: left; border-bottom: 1px solid var(--gray-200); }
        .ranking-table th { background-color: var(--gray-100); font-weight: 600; }
        .ranking-table tr:last-child td { border-bottom: none; }
        .ranking-table .posicao { font-weight: 700; font-size: 1.2rem; text-align: center; }
        .ranking-table .pos-1 .posicao { color: var(--gold); }
        .ranking-table .pos-2 .posicao { color: var(--silver); }
        .ranking-table .pos-3 .posicao { color: var(--bronze); }
        .ranking-table .nome { font-weight: 500; }
        .ranking-table .pontos { font-weight: 700; color: var(--primary-dark); }
        .loading, .error { text-align: center; padding: 40px; }
        .hidden { display: none; }
    </style>
</head>
<body>
    <div class="container">
        <div id="tela-ranking">
            <div class="card">
                <div class="header">
                    <h1 id="titulo-ranking">Ranking</h1>
                    <p id="subtitulo-ranking"></p>
                </div>
                <table class="ranking-table" id="tabela-ranking">
                    <thead>
                        <tr>
                            <th>Pos.</th>
                            <th>Nome</th>
                            <th>Pontos</th>
                            <th>PE</th>
                            <th>RC</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Linhas do ranking ser√£o inseridas aqui -->
                    </tbody>
                </table>
            </div>
        </div>

        <div id="tela-carregando" class="loading">
            <p>Carregando ranking...</p>
        </div>
        <div id="tela-erro" class="error hidden">
            <p id="erro-mensagem"></p>
        </div>
    </div>

    <script>
        let TelegramWebApp = window.Telegram.WebApp;

        document.addEventListener("DOMContentLoaded", () => {
            TelegramWebApp.ready();
            TelegramWebApp.expand();
            TelegramWebApp.BackButton.show().onClick(() => window.history.back());

            carregarDadosRanking();
        });

        function mostrarTela(tela) {
            ["ranking", "carregando", "erro"].forEach(id => document.getElementById(`tela-${id}`).classList.add("hidden"));
            document.getElementById(`tela-${tela}`).classList.remove("hidden");
        }

        function carregarDadosRanking() {
            mostrarTela("carregando");
            try {
                const urlParams = new URLSearchParams(window.location.search);
                const dataParam = urlParams.get("data");
                if (!dataParam) throw new Error("Dados do ranking n√£o encontrados.");

                const dadosJson = atob(dataParam);
                const rankingData = JSON.parse(dadosJson);

                popularTabela(rankingData);
                mostrarTela("ranking");
            } catch (error) {
                document.getElementById("erro-mensagem").textContent = `Erro: ${error.message}`;
                mostrarTela("erro");
            }
        }

        function popularTabela(data) {
            // Atualiza o t√≠tulo
            const titulo = document.getElementById("titulo-ranking");
            const subtitulo = document.getElementById("subtitulo-ranking");
            if (data.tipo_ranking === "rodada" && data.rodada_info) {
                titulo.textContent = `Ranking da ${data.rodada_info.numero}¬™ Rodada`;
            } else {
                titulo.textContent = "Ranking Geral";
            }
            subtitulo.textContent = `Gerado em: ${new Date(data.data_geracao).toLocaleString()}`;

            // Popula a tabela
            const tbody = document.querySelector("#tabela-ranking tbody");
            tbody.innerHTML = "";

            if (!data.ranking || data.ranking.length === 0) {
                tbody.innerHTML = '<tr><td colspan="5" style="text-align:center; padding: 20px;">Nenhuma pontua√ß√£o registrada ainda.</td></tr>';
                return;
            }

            data.ranking.forEach(user => {
                const tr = document.createElement("tr");
                tr.className = `pos-${user.posicao}`;
                tr.innerHTML = `
                    <td class="posicao"><i class="fas fa-trophy"></i> ${user.posicao}</td>
                    <td class="nome">${user.nome}</td>
                    <td class="pontos">${user.pontos}</td>
                    <td>${user.placares_exatos}</td>
                    <td>${user.resultados_corretos}</td>
                `;
                tbody.appendChild(tr);
            });
        }
    </script>
</body>
</html>
