<!-- webapps/admin_resultados.html -->
<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Inserir Resultados - Admin Bolão</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        :root {
            --primary: #3b82f6;
            --primary-dark: #2563eb;
            --secondary: #10b981;
            --secondary-dark: #059669;
            --warning: #f59e0b;
            --danger: #ef4444;
            --dark: #1f2937;
            --light: #f8fafc;
            --border: #e5e7eb;
            --card-bg: #ffffff;
        }
        
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            overflow: hidden;
            animation: slideIn 0.5s ease-out;
        }
        
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .header {
            background: linear-gradient(to right, var(--primary), var(--primary-dark));
            color: white;
            padding: 25px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .header h1 {
            font-size: 24px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .header-actions {
            display: flex;
            gap: 15px;
        }
        
        .filters {
            background: var(--light);
            padding: 20px 30px;
            border-bottom: 1px solid var(--border);
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            align-items: center;
        }
        
        .filter-group {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .filter-label {
            font-weight: 600;
            color: var(--dark);
            white-space: nowrap;
        }
        
        .filter-select {
            padding: 10px 15px;
            border: 2px solid var(--border);
            border-radius: 10px;
            background: white;
            font-size: 14px;
            min-width: 150px;
            cursor: pointer;
        }
        
        .filter-select:focus {
            outline: none;
            border-color: var(--primary);
        }
        
        .search-input {
            padding: 10px 15px;
            border: 2px solid var(--border);
            border-radius: 10px;
            font-size: 14px;
            min-width: 250px;
            flex: 1;
        }
        
        .search-input:focus {
            outline: none;
            border-color: var(--primary);
        }
        
        .stats {
            display: flex;
            gap: 30px;
            margin-left: auto;
        }
        
        .stat-item {
            text-align: center;
            padding: 10px 15px;
            background: white;
            border-radius: 10px;
            border: 1px solid var(--border);
            min-width: 120px;
        }
        
        .stat-value {
            font-size: 24px;
            font-weight: 700;
            color: var(--primary);
        }
        
        .stat-label {
            font-size: 12px;
            color: #6b7280;
            margin-top: 5px;
        }
        
        .content {
            display: grid;
            grid-template-columns: 1fr 350px;
            min-height: 700px;
        }
        
        .jogos-container {
            padding: 25px;
            max-height: 700px;
            overflow-y: auto;
            border-right: 1px solid var(--border);
        }
        
        .sidebar {
            padding: 25px;
            background: var(--light);
            max-height: 700px;
            overflow-y: auto;
        }
        
        .jogo-card {
            background: var(--card-bg);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            border: 2px solid var(--border);
            transition: all 0.3s;
        }
        
        .jogo-card.com-resultado {
            border-left: 5px solid var(--secondary);
        }
        
        .jogo-card.sem-resultado {
            border-left: 5px solid var(--warning);
        }
        
        .jogo-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }
        
        .jogo-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--border);
        }
        
        .jogo-times {
            display: flex;
            align-items: center;
            gap: 20px;
            flex: 1;
        }
        
        .time {
            text-align: center;
            flex: 1;
        }
        
        .time-name {
            font-weight: 700;
            font-size: 18px;
            margin-bottom: 5px;
            color: var(--dark);
        }
        
        .time-escudo {
            width: 50px;
            height: 50px;
            background: var(--light);
            border-radius: 50%;
            margin: 0 auto 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            color: var(--primary);
            font-weight: 700;
        }
        
        .vs {
            color: var(--primary);
            font-weight: 800;
            font-size: 20px;
        }
        
        .jogo-info {
            font-size: 14px;
            color: #6b7280;
            display: flex;
            gap: 20px;
        }
        
        .rodada-badge {
            background: var(--primary);
            color: white;
            padding: 5px 12px;
            border-radius: 15px;
            font-size: 12px;
            font-weight: 600;
        }
        
        .resultado-inputs {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 20px;
            margin-top: 20px;
        }
        
        .input-group {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .input-gols {
            width: 80px;
            height: 60px;
            font-size: 32px;
            font-weight: 700;
            text-align: center;
            border: 3px solid var(--border);
            border-radius: 10px;
            background: var(--light);
            color: var(--dark);
            transition: all 0.3s;
        }
        
        .input-gols:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.2);
            background: white;
        }
        
        .input-gols.invalid {
            border-color: var(--danger);
            background: #fef2f2;
        }
        
        .time-label {
            font-weight: 600;
            color: var(--dark);
            min-width: 100px;
        }
        
        .x {
            font-size: 24px;
            font-weight: 700;
            color: var(--primary);
            margin: 0 10px;
        }
        
        .jogo-actions {
            display: flex;
            gap: 10px;
            margin-top: 20px;
            justify-content: flex-end;
        }
        
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 10px;
            font-weight: 600;
            font-size: 14px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s;
        }
        
        .btn-sm {
            padding: 8px 15px;
            font-size: 13px;
        }
        
        .btn-primary {
            background: linear-gradient(to right, var(--secondary), var(--secondary-dark));
            color: white;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(16, 185, 129, 0.3);
        }
        
        .btn-secondary {
            background: white;
            color: var(--dark);
            border: 2px solid var(--border);
        }
        
        .btn-secondary:hover {
            background: var(--light);
        }
        
        .btn-warning {
            background: var(--warning);
            color: white;
        }
        
        .btn-warning:hover {
            background: #d97706;
            transform: translateY(-2px);
        }
        
        .sidebar-section {
            background: white;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            border: 1px solid var(--border);
        }
        
        .sidebar-title {
            font-size: 16px;
            font-weight: 600;
            color: var(--dark);
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .sidebar-title i {
            color: var(--primary);
        }
        
        .import-box {
            background: #f0f9ff;
            border: 2px dashed var(--primary);
            border-radius: 10px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            margin-bottom: 20px;
        }
        
        .import-box:hover {
            background: #e0f2fe;
            transform: translateY(-2px);
        }
        
        .import-icon {
            font-size: 40px;
            color: var(--primary);
            margin-bottom: 15px;
        }
        
        .summary-list {
            list-style: none;
        }
        
        .summary-item {
            padding: 10px 0;
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
        }
        
        .summary-item:last-child {
            border-bottom: none;
        }
        
        .loading {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            color: white;
        }
        
        .loading.show {
            display: flex;
        }
        
        .spinner {
            width: 50px;
            height: 50px;
            border: 5px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s linear infinite;
            margin-bottom: 20px;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            border-radius: 10px;
            color: white;
            font-weight: 500;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
            z-index: 1001;
            transform: translateX(150%);
            transition: transform 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }
        
        .notification.show {
            transform: translateX(0);
        }
        
        .notification.success {
            background: var(--secondary);
        }
        
        .notification.error {
            background: var(--danger);
        }
        
        .notification.warning {
            background: var(--warning);
        }
        
        .fullscreen-btn {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: var(--primary);
            color: white;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
            z-index: 999;
            transition: all 0.3s;
        }
        
        .fullscreen-btn:hover {
            background: var(--primary-dark);
            transform: scale(1.1);
        }
        
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #6b7280;
        }
        
        .empty-state i {
            font-size: 60px;
            margin-bottom: 20px;
            color: var(--border);
        }
        
        @media (max-width: 900px) {
            .content {
                grid-template-columns: 1fr;
            }
            
            .jogos-container {
                border-right: none;
                border-bottom: 1px solid var(--border);
            }
            
            .filters {
                flex-direction: column;
                align-items: stretch;
            }
            
            .search-input {
                min-width: auto;
            }
            
            .stats {
                margin-left: 0;
                justify-content: space-between;
            }
        }
        
        .resultado-badge {
            padding: 5px 12px;
            border-radius: 15px;
            font-size: 12px;
            font-weight: 600;
            display: inline-block;
        }
        
        .badge-success {
            background: var(--secondary);
            color: white;
        }
        
        .badge-warning {
            background: var(--warning);
            color: white;
        }
        
        .btn-group {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }
        
        .btn-group .btn {
            flex: 1;
            justify-content: center;
        }
    </style>
</head>
<body>
    <!-- Tela de carregamento -->
    <div class="loading" id="loading">
        <div class="spinner"></div>
        <p id="loadingText">Carregando jogos...</p>
    </div>
    
    <!-- Notificações -->
    <div class="notification" id="notification"></div>
    
    <!-- Botão tela cheia -->
    <div class="fullscreen-btn" onclick="toggleFullscreen()">
        <i class="fas fa-expand"></i>
    </div>
    
    <!-- Container principal -->
    <div class="container">
        <!-- Cabeçalho -->
        <div class="header">
            <h1><i class="fas fa-clipboard-check"></i> Inserir Resultados Reais</h1>
            <div class="header-actions">
                <button class="btn btn-secondary" onclick="voltarMenu()">
                    <i class="fas fa-arrow-left"></i> Voltar
                </button>
                <button class="btn btn-primary" onclick="salvarTodosResultados()">
                    <i class="fas fa-save"></i> Salvar Todos
                </button>
            </div>
        </div>
        
        <!-- Filtros -->
        <div class="filters">
            <div class="filter-group">
                <span class="filter-label">Filtrar por:</span>
                <select class="filter-select" id="filterStatus" onchange="filtrarJogos()">
                    <option value="todos">Todos os jogos</option>
                    <option value="sem_resultado">Sem resultado</option>
                    <option value="com_resultado">Com resultado</option>
                </select>
            </div>
            
            <div class="filter-group">
                <span class="filter-label">Rodada:</span>
                <select class="filter-select" id="filterRodada" onchange="filtrarJogos()">
                    <option value="todas">Todas as rodadas</option>
                    <!-- Rodadas serão carregadas via JS -->
                </select>
            </div>
            
            <input type="text" class="search-input" id="searchJogo" placeholder="Buscar por time..." oninput="filtrarJogos()">
            
            <div class="stats">
                <div class="stat-item">
                    <div class="stat-value" id="statTotal">0</div>
                    <div class="stat-label">Total Jogos</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="statSemResultado">0</div>
                    <div class="stat-label">Sem Resultado</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="statComResultado">0</div>
                    <div class="stat-label">Com Resultado</div>
                </div>
            </div>
        </div>
        
        <!-- Conteúdo principal -->
        <div class="content">
            <!-- Lista de jogos -->
            <div class="jogos-container" id="jogosContainer">
                <!-- Jogos serão carregados aqui via JavaScript -->
            </div>
            
            <!-- Sidebar -->
            <div class="sidebar">
                <div class="sidebar-section">
                    <div class="sidebar-title">
                        <i class="fas fa-file-import"></i> Importar da Planilha
                    </div>
                    <div class="import-box" onclick="importarPlanilha()">
                        <div class="import-icon">
                            <i class="fas fa-file-excel"></i>
                        </div>
                        <h3>Importar do Excel</h3>
                        <p>Importe resultados das colunas M e O da planilha Bolão2026.xlsx</p>
                    </div>
                    
                    <div class="btn-group">
                        <button class="btn btn-primary" onclick="importarTodasRodadas()">
                            <i class="fas fa-download"></i> Importar Tudo
                        </button>
                        <button class="btn btn-warning" onclick="calcularPontuacao()">
                            <i class="fas fa-calculator"></i> Calcular Pontuação
                        </button>
                    </div>
                </div>
                
                <div class="sidebar-section">
                    <div class="sidebar-title">
                        <i class="fas fa-chart-bar"></i> Resumo
                    </div>
                    <ul class="summary-list" id="summaryList">
                        <!-- Resumo será carregado via JS -->
                    </ul>
                </div>
                
                <div class="sidebar-section">
                    <div class="sidebar-title">
                        <i class="fas fa-lightbulb"></i> Instruções
                    </div>
                    <p style="font-size: 13px; color: #6b7280; line-height: 1.5;">
                        1. Preencha os placares reais nos campos de cada jogo<br>
                        2. Clique em "Salvar" para salvar individualmente<br>
                        3. Ou use "Salvar Todos" para salvar tudo de uma vez<br>
                        4. Importe do Excel para carregar resultados automaticamente<br>
                        5. Após inserir resultados, calcule a pontuação
                    </p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Variáveis globais
        let jogos = [];
        let resultadosEditados = {};
        let rodadasDisponiveis = [];
        let jogosFiltrados = [];
        
        // Inicializar quando a página carrega
        document.addEventListener('DOMContentLoaded', function() {
            // Forçar tela cheia
            requestFullscreen();
            
            // Carregar dados
            carregarDados();
            
            // Configurar validação em tempo real
            configurarValidacao();
        });
        
        // Funções de tela cheia
        function requestFullscreen() {
            const elem = document.documentElement;
            if (elem.requestFullscreen) {
                elem.requestFullscreen();
            } else if (elem.webkitRequestFullscreen) {
                elem.webkitRequestFullscreen();
            } else if (elem.msRequestFullscreen) {
                elem.msRequestFullscreen();
            }
        }
        
        function toggleFullscreen() {
            if (!document.fullscreenElement) {
                requestFullscreen();
            } else {
                if (document.exitFullscreen) {
                    document.exitFullscreen();
                }
            }
        }
        
        // Carregar dados
        function carregarDados() {
            showLoading(true, 'Carregando jogos...');
            
            // Simular carregamento de dados
            setTimeout(() => {
                // Dados de exemplo
                jogos = [
                    {
                        id: 101,
                        rodada: 5,
                        time_mandante: "São Paulo",
                        time_visitante: "Corinthians",
                        data: "2026-01-20T16:00:00",
                        gols_mandante: 2,
                        gols_visitante: 1,
                        tem_resultado: true
                    },
                    {
                        id: 102,
                        rodada: 5,
                        time_mandante: "Palmeiras",
                        time_visitante: "Santos",
                        data: "2026-01-20T18:00:00",
                        gols_mandante: null,
                        gols_visitante: null,
                        tem_resultado: false
                    },
                    {
                        id: 103,
                        rodada: 5,
                        time_mandante: "Flamengo",
                        time_visitante: "Vasco",
                        data: "2026-01-21T16:00:00",
                        gols_mandante: 3,
                        gols_visitante: 0,
                        tem_resultado: true
                    },
                    {
                        id: 104,
                        rodada: 5,
                        time_mandante: "Grêmio",
                        time_visitante: "Internacional",
                        data: "2026-01-21T18:00:00",
                        gols_mandante: null,
                        gols_visitante: null,
                        tem_resultado: false
                    },
                    {
                        id: 105,
                        rodada: 6,
                        time_mandante: "Atlético-MG",
                        time_visitante: "Cruzeiro",
                        data: "2026-01-27T16:00:00",
                        gols_mandante: 1,
                        gols_visitante: 1,
                        tem_resultado: true
                    },
                    {
                        id: 106,
                        rodada: 6,
                        time_mandante: "Botafogo",
                        time_visitante: "Fluminense",
                        data: "2026-01-27T18:00:00",
                        gols_mandante: null,
                        gols_visitante: null,
                        tem_resultado: false
                    }
                ];
                
                // Extrair rodadas disponíveis
                rodadasDisponiveis = [...new Set(jogos.map(j => j.rodada))].sort((a, b) => a - b);
                
                // Popular select de rodadas
                popularSelectRodadas();
                
                // Renderizar jogos
                jogosFiltrados = [...jogos];
                renderizarJogos();
                
                // Atualizar estatísticas
                atualizarEstatisticas();
                atualizarResumo();
                
                showLoading(false);
            }, 1500);
        }
        
        function popularSelectRodadas() {
            const select = document.getElementById('filterRodada');
            
            // Limpar opções existentes (exceto a primeira)
            while (select.options.length > 1) {
                select.remove(1);
            }
            
            // Adicionar rodadas
            rodadasDisponiveis.forEach(rodada => {
                const option = document.createElement('option');
                option.value = rodada;
                option.textContent = `Rodada ${rodada}`;
                select.appendChild(option);
            });
        }
        
        function renderizarJogos() {
            const container = document.getElementById('jogosContainer');
            
            if (jogosFiltrados.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-futbol"></i>
                        <h3>Nenhum jogo encontrado</h3>
                        <p>Não há jogos correspondentes aos filtros aplicados.</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = '';
            
            jogosFiltrados.forEach(jogo => {
                const temResultado = jogo.tem_resultado;
                const classeCSS = temResultado ? 'com-resultado' : 'sem-resultado';
                
                // Verificar se há resultado editado não salvo
                const resultadoEditado = resultadosEditados[jogo.id];
                const golsMandante = resultadoEditado?.mandante !== undefined ? resultadoEditado.mandante : jogo.gols_mandante;
                const golsVisitante = resultadoEditado?.visitante !== undefined ? resultadoEditado.visitante : jogo.gols_visitante;
                
                const jogoElement = document.createElement('div');
                jogoElement.className = `jogo-card ${classeCSS}`;
                jogoElement.id = `jogo-${jogo.id}`;
                
                // Formatar data
                const dataObj = new Date(jogo.data);
                const dataFormatada = dataObj.toLocaleDateString('pt-BR', {
                    weekday: 'short',
                    day: 'numeric',
                    month: 'short'
                });
                const horaFormatada = dataObj.toLocaleTimeString('pt-BR', {
                    hour: '2-digit',
                    minute: '2-digit'
                });
                
                jogoElement.innerHTML = `
                    <div class="jogo-header">
                        <div class="jogo-times">
                            <div class="time">
                                <div class="time-escudo">${getIniciais(jogo.time_mandante)}</div>
                                <div class="time-name">${jogo.time_mandante}</div>
                            </div>
                            <div class="vs">VS</div>
                            <div class="time">
                                <div class="time-escudo">${getIniciais(jogo.time_visitante)}</div>
                                <div class="time-name">${jogo.time_visitante}</div>
                            </div>
                        </div>
                        <div>
                            <span class="rodada-badge">Rodada ${jogo.rodada}</span>
                            ${temResultado ? 
                                '<span class="resultado-badge badge-success" style="margin-left: 10px;"><i class="fas fa-check"></i> Com resultado</span>' 
                                : '<span class="resultado-badge badge-warning" style="margin-left: 10px;"><i class="fas fa-clock"></i> Sem resultado</span>'
                            }
                        </div>
                    </div>
                    
                    <div class="jogo-info">
                        <span><i class="far fa-calendar"></i> ${dataFormatada}</span>
                        <span><i class="far fa-clock"></i> ${horaFormatada}</span>
                        <span><i class="fas fa-hashtag"></i> ID: ${jogo.id}</span>
                    </div>
                    
                    <div class="resultado-inputs">
                        <div class="input-group">
                            <div class="time-label">${jogo.time_mandante}:</div>
                            <input type="number" 
                                   class="input-gols ${golsMandante !== null && golsMandante !== undefined ? 'has-value' : ''}"
                                   id="mandante-${jogo.id}"
                                   min="0" 
                                   max="20"
                                   value="${golsMandante !== null && golsMandante !== undefined ? golsMandante : ''}"
                                   oninput="validarGol(this, ${jogo.id}, 'mandante')"
                                   placeholder="0">
                        </div>
                        <div class="x">X</div>
                        <div class="input-group">
                            <input type="number" 
                                   class="input-gols ${golsVisitante !== null && golsVisitante !== undefined ? 'has-value' : ''}"
                                   id="visitante-${jogo.id}"
                                   min="0" 
                                   max="20"
                                   value="${golsVisitante !== null && golsVisitante !== undefined ? golsVisitante : ''}"
                                   oninput="validarGol(this, ${jogo.id}, 'visitante')"
                                   placeholder="0">
                            <div class="time-label">${jogo.time_visitante}:</div>
                        </div>
                    </div>
                    
                    <div class="jogo-actions">
                        <button class="btn btn-secondary btn-sm" onclick="limparResultado(${jogo.id})">
                            <i class="fas fa-eraser"></i> Limpar
                        </button>
                        <button class="btn btn-primary btn-sm" onclick="salvarResultado(${jogo.id})" 
                                ${resultadosEditados[jogo.id] ? '' : 'disabled'}>
                            <i class="fas fa-save"></i> Salvar
                        </button>
                    </div>
                `;
                
                container.appendChild(jogoElement);
            });
        }
        
        function getIniciais(time) {
            return time.split(' ').map(word => word[0]).join('').toUpperCase().substring(0, 2);
        }
        
        // Filtros
        function filtrarJogos() {
            const statusFilter = document.getElementById('filterStatus').value;
            const rodadaFilter = document.getElementById('filterRodada').value;
            const searchTerm = document.getElementById('searchJogo').value.toLowerCase();
            
            jogosFiltrados = jogos.filter(jogo => {
                // Filtro por status
                if (statusFilter === 'sem_resultado' && jogo.tem_resultado) return false;
                if (statusFilter === 'com_resultado' && !jogo.tem_resultado) return false;
                
                // Filtro por rodada
                if (rodadaFilter !== 'todas' && jogo.rodada != rodadaFilter) return false;
                
                // Filtro por busca
                if (searchTerm && 
                    !jogo.time_mandante.toLowerCase().includes(searchTerm) && 
                    !jogo.time_visitante.toLowerCase().includes(searchTerm)) {
                    return false;
                }
                
                return true;
            });
            
            renderizarJogos();
            atualizarEstatisticas();
        }
        
        // Validação
        function configurarValidacao() {
            // Adicionar validação em tempo real para todos inputs
            document.addEventListener('input', function(e) {
                if (e.target.classList.contains('input-gols')) {
                    validarInputGol(e.target);
                }
            });
        }
        
        function validarInputGol(input) {
            const valor = input.value.trim();
            
            if (valor === '') {
                input.classList.remove('invalid');
                return;
            }
            
            const num = parseInt(valor);
            if (isNaN(num) || num < 0 || num > 20) {
                input.classList.add('invalid');
            } else {
                input.classList.remove('invalid');
            }
        }
        
        function validarGol(input, jogoId, tipo) {
            validarInputGol(input);
            
            const valor = input.value.trim();
            const num = valor === '' ? null : parseInt(valor);
            
            // Armazenar edição
            if (!resultadosEditados[jogoId]) {
                resultadosEditados[jogoId] = {};
            }
            
            resultadosEditados[jogoId][tipo] = num;
            
            // Habilitar botão salvar
            const salvarBtn = document.querySelector(`#jogo-${jogoId} .btn-primary`);
            if (salvarBtn) {
                salvarBtn.disabled = false;
            }
        }
        
        // Operações com resultados
        function salvarResultado(jogoId) {
            const resultado = resultadosEditados[jogoId];
            if (!resultado || (resultado.mandante === undefined && resultado.visitante === undefined)) {
                showNotification('Nenhuma alteração para salvar', 'warning');
                return;
            }
            
            showLoading(true, 'Salvando resultado...');
            
            // Simular salvamento
            setTimeout(() => {
                // Atualizar jogo localmente
                const jogoIndex = jogos.findIndex(j => j.id === jogoId);
                if (jogoIndex !== -1) {
                    const jogo = jogos[jogoIndex];
                    
                    if (resultado.mandante !== undefined) {
                        jogo.gols_mandante = resultado.mandante;
                    }
                    if (resultado.visitante !== undefined) {
                        jogo.gols_visitante = resultado.visitante;
                    }
                    
                    // Marcar como tendo resultado se ambos gols preenchidos
                    if (jogo.gols_mandante !== null && jogo.gols_visitante !== null) {
                        jogo.tem_resultado = true;
                    } else {
                        jogo.tem_resultado = false;
                    }
                }
                
                // Limpar edição
                delete resultadosEditados[jogoId];
                
                // Re-renderizar
                renderizarJogos();
                atualizarEstatisticas();
                atualizarResumo();
                
                showLoading(false);
                showNotification('Resultado salvo com sucesso!', 'success');
                
                // Log
                console.log(`Resultado salvo para jogo ${jogoId}:`, resultado);
                
            }, 1000);
        }
        
        function salvarTodosResultados() {
            const jogosComEdicao = Object.keys(resultadosEditados);
            
            if (jogosComEdicao.length === 0) {
                showNotification('Nenhuma alteração para salvar', 'warning');
                return;
            }
            
            if (!confirm(`Deseja salvar ${jogosComEdicao.length} resultado(s)?`)) {
                return;
            }
            
            showLoading(true, `Salvando ${jogosComEdicao.length} resultados...`);
            
            // Simular salvamento em lote
            setTimeout(() => {
                jogosComEdicao.forEach(jogoId => {
                    const resultado = resultadosEditados[jogoId];
                    const jogoIndex = jogos.findIndex(j => j.id === parseInt(jogoId));
                    
                    if (jogoIndex !== -1 && resultado) {
                        const jogo = jogos[jogoIndex];
                        
                        if (resultado.mandante !== undefined) {
                            jogo.gols_mandante = resultado.mandante;
                        }
                        if (resultado.visitante !== undefined) {
                            jogo.gols_visitante = resultado.visitante;
                        }
                        
                        if (jogo.gols_mandante !== null && jogo.gols_visitante !== null) {
                            jogo.tem_resultado = true;
                        }
                    }
                });
                
                // Limpar todas edições
                resultadosEditados = {};
                
                // Re-renderizar
                renderizarJogos();
                atualizarEstatisticas();
                atualizarResumo();
                
                showLoading(false);
                showNotification(`${jogosComEdicao.length} resultados salvos com sucesso!`, 'success');
                
            }, 2000);
        }
        
        function limparResultado(jogoId) {
            if (!confirm('Deseja limpar o resultado deste jogo?')) {
                return;
            }
            
            // Limpar inputs
            document.getElementById(`mandante-${jogoId}`).value = '';
            document.getElementById(`visitante-${jogoId}`).value = '';
            
            // Marcar para limpeza
            resultadosEditados[jogoId] = {
                mandante: null,
                visitante: null
            };
            
            // Habilitar botão salvar
            const salvarBtn = document.querySelector(`#jogo-${jogoId} .btn-primary`);
            if (salvarBtn) {
                salvarBtn.disabled = false;
            }
            
            showNotification('Resultado marcado para limpeza', 'warning');
        }
        
        // Importação
        function importarPlanilha() {
            showLoading(true, 'Importando da planilha...');
            
            // Simular importação
            setTimeout(() => {
                // Em implementação real, isso chamaria o backend
                // Aqui simulamos importação de alguns resultados
                
                // Adicionar alguns resultados simulados
                const novosResultados = [
                    { id: 102, mandante: 2, visitante: 0 },
                    { id: 104, mandante: 1, visitante: 1 },
                    { id: 106, mandante: 3, visitante: 2 }
                ];
                
                novosResultados.forEach(novo => {
                    const jogoIndex = jogos.findIndex(j => j.id === novo.id);
                    if (jogoIndex !== -1) {
                        jogos[jogoIndex].gols_mandante = novo.mandante;
                        jogos[jogoIndex].gols_visitante = novo.visitante;
                        jogos[jogoIndex].tem_resultado = true;
                    }
                });
                
                // Re-renderizar
                renderizarJogos();
                atualizarEstatisticas();
                atualizarResumo();
                
                showLoading(false);
                showNotification('3 resultados importados da planilha!', 'success');
                
            }, 2000);
        }
        
        function importarTodasRodadas() {
            if (!confirm('Importar resultados de TODAS as rodadas da planilha?')) {
                return;
            }
            
            showLoading(true, 'Importando todas as rodadas...');
            
            // Simulação
            setTimeout(() => {
                // Marcar todos os jogos como tendo resultado (simulação)
                jogos.forEach(jogo => {
                    if (!jogo.tem_resultado) {
                        jogo.gols_mandante = Math.floor(Math.random() * 4);
                        jogo.gols_visitante = Math.floor(Math.random() * 4);
                        jogo.tem_resultado = true;
                    }
                });
                
                renderizarJogos();
                atualizarEstatisticas();
                atualizarResumo();
                
                showLoading(false);
                showNotification('Todos os resultados importados!', 'success');
                
            }, 2500);
        }
        
        function calcularPontuacao() {
            if (!confirm('Calcular pontuação para todas as rodadas com resultados?')) {
                return;
            }
            
            showLoading(true, 'Calculando pontuação...');
            
            // Simulação
            setTimeout(() => {
                showLoading(false);
                showNotification('Pontuação calculada com sucesso! Ranking atualizado.', 'success');
                
                // Em implementação real, isso dispararia o cálculo no backend
                console.log('Cálculo de pontuação solicitado');
                
            }, 3000);
        }
        
        // Estatísticas e resumo
        function atualizarEstatisticas() {
            const total = jogosFiltrados.length;
            const semResultado = jogosFiltrados.filter(j => !j.tem_resultado).length;
            const comResultado = total - semResultado;
            
            document.getElementById('statTotal').textContent = total;
            document.getElementById('statSemResultado').textContent = semResultado;
            document.getElementById('statComResultado').textContent = comResultado;
        }
        
        function atualizarResumo() {
            const summaryList = document.getElementById('summaryList');
            
            // Estatísticas gerais
            const totalJogos = jogos.length;
            const jogosComResultado = jogos.filter(j => j.tem_resultado).length;
            const jogosSemResultado = totalJogos - jogosComResultado;
            const percentualCompleto = totalJogos > 0 ? Math.round((jogosComResultado / totalJogos) * 100) : 0;
            
            // Agrupar por rodada
            const rodadasAgrupadas = {};
            jogos.forEach(jogo => {
                if (!rodadasAgrupadas[jogo.rodada]) {
                    rodadasAgrupadas[jogo.rodada] = { total: 0, comResultado: 0 };
                }
                rodadasAgrupadas[jogo.rodada].total++;
                if (jogo.tem_resultado) {
                    rodadasAgrupadas[jogo.rodada].comResultado++;
                }
            });
            
            // Construir HTML
            let html = `
                <li class="summary-item">
                    <span>Total de Jogos:</span>
                    <strong>${totalJogos}</strong>
                </li>
                <li class="summary-item">
                    <span>Com Resultado:</span>
                    <strong>${jogosComResultado} (${percentualCompleto}%)</strong>
                </li>
                <li class="summary-item">
                    <span>Sem Resultado:</span>
                    <strong>${jogosSemResultado}</strong>
                </li>
                <li class="summary-item">
                    <span>Editados não salvos:</span>
                    <strong>${Object.keys(resultadosEditados).length}</strong>
                </li>
            `;
            
            // Adicionar por rodada
            Object.keys(rodadasAgrupadas).sort().forEach(rodada => {
                const dados = rodadasAgrupadas[rodada];
                const percentual = dados.total > 0 ? Math.round((dados.comResultado / dados.total) * 100) : 0;
                
                html += `
                    <li class="summary-item">
                        <span>Rodada ${rodada}:</span>
                        <strong>${dados.comResultado}/${dados.total} (${percentual}%)</strong>
                    </li>
                `;
            });
            
            summaryList.innerHTML = html;
        }
        
        // Navegação
        function voltarMenu() {
            if (Object.keys(resultadosEditados).length > 0) {
                if (!confirm('Há alterações não salvas. Deseja realmente sair?')) {
                    return;
                }
            }
            
            if (typeof Telegram !== 'undefined' && Telegram.WebApp) {
                Telegram.WebApp.close();
            } else {
                showNotification('Voltando ao menu...', 'warning');
                // Em desenvolvimento
            }
        }
        
        // Funções de UI
        function showLoading(show, texto = 'Carregando...') {
            const loading = document.getElementById('loading');
            const loadingText = document.getElementById('loadingText');
            
            if (loadingText) {
                loadingText.textContent = texto;
            }
            
            loading.classList.toggle('show', show);
        }
        
        function showNotification(mensagem, tipo = 'success') {
            const notification = document.getElementById('notification');
            notification.textContent = mensagem;
            notification.className = `notification ${tipo}`;
            notification.classList.add('show');
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }
        
        // Detectar se está no Telegram Web App
        if (typeof Telegram !== 'undefined' && Telegram.WebApp) {
            Telegram.WebApp.ready();
            Telegram.WebApp.expand();
            
            // Configurar botão de fechar
            Telegram.WebApp.MainButton.setText('FECHAR').show().onClick(function() {
                if (Object.keys(resultadosEditados).length > 0) {
                    if (confirm('Há alterações não salvas. Deseja realmente sair?')) {
                        Telegram.WebApp.close();
                    }
                } else {
                    Telegram.WebApp.close();
                }
            });
        }
    </script>
</body>
</html>
