<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Criar Rodada - Bol√£o</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            color: white;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            flex: 1;
        }
        
        header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        h1 {
            font-size: 24px;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }
        
        .tipo-rodada {
            font-size: 18px;
            opacity: 0.9;
            margin-bottom: 5px;
        }
        
        .main-content {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 25px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            margin-bottom: 20px;
        }
        
        .section {
            margin-bottom: 25px;
        }
        
        .section-title {
            font-size: 18px;
            margin-bottom: 15px;
            padding-bottom: 8px;
            border-bottom: 2px solid rgba(255, 255, 255, 0.3);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .section-title i {
            font-size: 20px;
        }
        
        .jogos-list {
            display: grid;
            gap: 10px;
            max-height: 300px;
            overflow-y: auto;
            padding: 10px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 10px;
        }
        
        .jogo-item {
            display: flex;
            align-items: center;
            padding: 12px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }
        
        .jogo-item:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-2px);
        }
        
        .jogo-item.selected {
            background: rgba(46, 204, 113, 0.3);
            border-color: #2ecc71;
        }
        
        .jogo-times {
            flex: 1;
            text-align: center;
            font-weight: bold;
            font-size: 16px;
        }
        
        .checkbox {
            width: 24px;
            height: 24px;
            border: 2px solid rgba(255, 255, 255, 0.5);
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 15px;
            transition: all 0.3s ease;
        }
        
        .checkbox.selected {
            background: #2ecc71;
            border-color: #2ecc71;
        }
        
        .checkbox.selected::after {
            content: "‚úì";
            color: white;
            font-weight: bold;
        }
        
        .time-selector {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 15px;
            padding: 15px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 10px;
        }
        
        input[type="datetime-local"] {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.9);
            font-size: 16px;
            color: #333;
        }
        
        .usuarios-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 10px;
            max-height: 200px;
            overflow-y: auto;
            padding: 10px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 10px;
        }
        
        .usuario-item {
            padding: 10px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
            text-align: center;
        }
        
        .usuario-item:hover {
            background: rgba(255, 255, 255, 0.2);
        }
        
        .usuario-item.selected {
            background: rgba(52, 152, 219, 0.3);
            border-color: #3498db;
        }
        
        .actions {
            display: flex;
            gap: 15px;
            margin-top: 30px;
        }
        
        button {
            flex: 1;
            padding: 18px;
            border: none;
            border-radius: 12px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .btn-enviar {
            background: linear-gradient(135deg, #2ecc71, #27ae60);
            color: white;
        }
        
        .btn-enviar:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 20px rgba(46, 204, 113, 0.4);
        }
        
        .btn-voltar {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: 2px solid rgba(255, 255, 255, 0.3);
        }
        
        .btn-voltar:hover {
            background: rgba(255, 255, 255, 0.3);
        }
        
        footer {
            text-align: center;
            padding: 15px;
            font-size: 14px;
            opacity: 0.8;
            margin-top: 20px;
        }
        
        /* Estilos para m√∫ltiplas rodadas */
        .rodada-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            overflow-x: auto;
            padding-bottom: 10px;
        }
        
        .rodada-tab {
            padding: 10px 20px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            white-space: nowrap;
            border: 2px solid transparent;
        }
        
        .rodada-tab.active {
            background: rgba(155, 89, 182, 0.4);
            border-color: #9b59b6;
        }
        
        .rodada-tab:hover:not(.active) {
            background: rgba(255, 255, 255, 0.2);
        }
        
        .hidden {
            display: none;
        }
        
        /* Scrollbar personalizada */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.3);
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: rgba(255, 255, 255, 0.4);
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üéØ CRIAR RODADA</h1>
            <div class="tipo-rodada" id="tipoRodada">Rodada √önica</div>
            <div id="infoMultipla" class="hidden">
                <p>Selecione as rodadas abaixo:</p>
            </div>
        </header>
        
        <div class="main-content">
            <!-- Tabs para m√∫ltiplas rodadas (vis√≠vel apenas no modo m√∫ltipla) -->
            <div id="rodadaTabs" class="rodada-tabs hidden"></div>
            
            <!-- Sele√ß√£o de Rodada (apenas para m√∫ltipla) -->
            <div id="selecaoRodadas" class="section hidden">
                <div class="section-title">
                    <i>üî¢</i> Selecionar Rodadas
                </div>
                <div id="listaRodadas" class="jogos-list">
                    <!-- As rodadas ser√£o carregadas aqui -->
                </div>
            </div>
            
            <!-- Sele√ß√£o de Jogos -->
            <div class="section">
                <div class="section-title">
                    <i>‚öΩ</i> Selecionar Jogos
                </div>
                <div id="jogosContainer">
                    <div id="listaJogos" class="jogos-list">
                        <!-- Os jogos ser√£o carregados aqui -->
                    </div>
                </div>
            </div>
            
            <!-- Hor√°rio de Fechamento -->
            <div class="section">
                <div class="section-title">
                    <i>‚è∞</i> Hor√°rio de Fechamento
                </div>
                <div class="time-selector">
                    <input type="datetime-local" id="horarioFechamento">
                </div>
            </div>
            
            <!-- Pontua√ß√£o Dobrada -->
            <div class="section">
                <div class="section-title">
                    <i>‚≠ê</i> Pontua√ß√£o Dobrada
                </div>
                <div id="usuariosDobrada" class="usuarios-list">
                    <!-- Usu√°rios ser√£o carregados aqui -->
                </div>
            </div>
            
            <!-- Trunfo -->
            <div class="section">
                <div class="section-title">
                    <i>üé¥</i> Trunfo
                </div>
                <div id="usuariosTrunfo" class="usuarios-list">
                    <!-- Usu√°rios ser√£o carregados aqui -->
                </div>
            </div>
        </div>
        
        <div class="actions">
            <button class="btn-voltar" onclick="voltar()">VOLTAR</button>
            <button class="btn-enviar" onclick="enviarRodada()">ENVIAR RODADA</button>
        </div>
        
        <footer>
            Bot Bol√£o - Administra√ß√£o
        </footer>
    </div>

    <script>
        // Verifica se estamos no Telegram Web App
        if (window.Telegram && Telegram.WebApp) {
            Telegram.WebApp.expand();
            Telegram.WebApp.enableClosingConfirmation();
        }
        
        // Obt√©m par√¢metros da URL
        const urlParams = new URLSearchParams(window.location.search);
        const tipo = urlParams.get('tipo') || 'unica';
        
        // Vari√°veis globais
        let jogosSelecionados = {};
        let usuariosDobrada = [];
        let usuariosTrunfo = [];
        let rodadasSelecionadas = [];
        let rodadaAtual = 1;
        let dadosPorRodada = {};
        
        // Inicializa a p√°gina
        document.addEventListener('DOMContentLoaded', function() {
            const tipoRodadaElement = document.getElementById('tipoRodada');
            const infoMultiplaElement = document.getElementById('infoMultipla');
            const rodadaTabsElement = document.getElementById('rodadaTabs');
            const selecaoRodadasElement = document.getElementById('selecaoRodadas');
            
            if (tipo === 'multipla') {
                tipoRodadaElement.textContent = 'M√∫ltiplas Rodadas';
                infoMultiplaElement.classList.remove('hidden');
                rodadaTabsElement.classList.remove('hidden');
                selecaoRodadasElement.classList.remove('hidden');
                
                // Inicializa dados para m√∫ltiplas rodadas
                inicializarModoMultipla();
            } else {
                tipoRodadaElement.textContent = 'Rodada √önica';
                dadosPorRodada[1] = {
                    jogos: [],
                    horario: '',
                    dobrada: [],
                    trunfo: []
                };
            }
            
            // Carrega dados iniciais
            carregarJogos();
            carregarUsuarios();
            if (tipo === 'multipla') {
                carregarRodadasDisponiveis();
            }
        });
        
        function inicializarModoMultipla() {
            // Cria estrutura inicial para m√∫ltiplas rodadas
            dadosPorRodada = {};
            
            // Adiciona listeners para alternar entre rodadas
            document.getElementById('horarioFechamento').addEventListener('change', function() {
                if (dadosPorRodada[rodadaAtual]) {
                    dadosPorRodada[rodadaAtual].horario = this.value;
                }
            });
        }
        
        function carregarJogos() {
    const jogosList = document.getElementById('listaJogos');
    jogosList.innerHTML = '<div style="text-align: center; padding: 20px;">Carregando jogos dispon√≠veis...</div>';
    
    // Obt√©m a rodada da URL
    const urlParams = new URLSearchParams(window.location.search);
    const tipo = urlParams.get('tipo');
    const rodadaParam = urlParams.get('rodada');
    const rodadasParam = urlParams.get('rodadas');
    
    let rodadas = [];
    
    if (tipo === 'unica' && rodadaParam) {
        rodadas = [parseInt(rodadaParam)];
    } else if (tipo === 'multipla' && rodadasParam) {
        rodadas = rodadasParam.split(',').map(r => parseInt(r.trim()));
    }
    
    // Envia requisi√ß√£o para API do bot (simulada)
    if (window.Telegram && Telegram.WebApp) {
        Telegram.WebApp.sendData(JSON.stringify({
            acao: 'carregar_jogos',
            tipo: tipo,
            rodadas: rodadas
        }));
        
        // Em produ√ß√£o, isso seria uma chamada HTTP real
        // Por enquanto, usamos dados simulados
        setTimeout(() => {
            simularCarregamentoJogos(rodadas);
        }, 500);
    } else {
        // Modo desenvolvimento
        setTimeout(() => {
            simularCarregamentoJogos(rodadas);
        }, 500);
    }
}

function simularCarregamentoJogos(rodadas) {
    const jogosList = document.getElementById('listaJogos');
    
    // Simula√ß√£o - em produ√ß√£o isso viria do bot
    let jogosExemplo = [];
    
    // Para cada rodada, adiciona alguns jogos
    rodadas.forEach(rodada => {
        for (let i = 1; i <= 5; i++) { // 5 jogos por rodada
            jogosExemplo.push({
                id: rodada * 10 + i,
                rodada: rodada,
                mandante: `Time ${rodada}A${i}`,
                visitante: `Time ${rodada}B${i}`
            });
        }
    });
    
    if (jogosExemplo.length === 0) {
        jogosList.innerHTML = '<div style="text-align: center; padding: 20px; color: #ff6b6b;">Nenhum jogo dispon√≠vel para estas rodadas.</div>';
        return;
    }
    
    jogosList.innerHTML = '';
    
    jogosExemplo.forEach(jogo => {
        const jogoDiv = document.createElement('div');
        jogoDiv.className = 'jogo-item';
        jogoDiv.dataset.id = jogo.id;
        jogoDiv.dataset.rodada = jogo.rodada;
        
        jogoDiv.innerHTML = `
            <div class="checkbox"></div>
            <div class="jogo-times">${jogo.mandante} x ${jogo.visitante} (R${jogo.rodada})</div>
        `;
        
        jogoDiv.addEventListener('click', function() {
            selecionarJogo(jogo.id, this);
        });
        
        jogosList.appendChild(jogoDiv);
    });
}

function carregarUsuarios() {
    const usuariosDobradaList = document.getElementById('usuariosDobrada');
    const usuariosTrunfoList = document.getElementById('usuariosTrunfo');
    
    usuariosDobradaList.innerHTML = '<div style="text-align: center; padding: 10px;">Carregando usu√°rios...</div>';
    usuariosTrunfoList.innerHTML = '<div style="text-align: center; padding: 10px;">Carregando usu√°rios...</div>';
    
    if (window.Telegram && Telegram.WebApp) {
        Telegram.WebApp.sendData(JSON.stringify({
            acao: 'carregar_usuarios'
        }));
        
        setTimeout(() => {
            simularCarregamentoUsuarios();
        }, 500);
    } else {
        setTimeout(() => {
            simularCarregamentoUsuarios();
        }, 500);
    }
}

function simularCarregamentoUsuarios() {
    const usuariosDobradaList = document.getElementById('usuariosDobrada');
    const usuariosTrunfoList = document.getElementById('usuariosTrunfo');
    
    // Simula√ß√£o - em produ√ß√£o isso viria do bot
    const usuariosExemplo = [
        { id: 1, nome: "Bruno" }  // Apenas voc√™
    ];
    
    // Preenche lista de Pontua√ß√£o Dobrada
    usuariosDobradaList.innerHTML = '';
    usuariosExemplo.forEach(usuario => {
        const usuarioDiv = document.createElement('div');
        usuarioDiv.className = 'usuario-item';
        usuarioDiv.dataset.id = usuario.id;
        usuarioDiv.textContent = usuario.nome;
        
        usuarioDiv.addEventListener('click', function() {
            selecionarUsuario(usuario.id, this, 'dobrada');
        });
        
        usuariosDobradaList.appendChild(usuarioDiv);
    });
    
    // Preenche lista de Trunfo
    usuariosTrunfoList.innerHTML = '';
    usuariosExemplo.forEach(usuario => {
        const usuarioDiv = document.createElement('div');
        usuarioDiv.className = 'usuario-item';
        usuarioDiv.dataset.id = usuario.id;
        usuarioDiv.textContent = usuario.nome;
        
        usuarioDiv.addEventListener('click', function() {
            selecionarUsuario(usuario.id, this, 'trunfo');
        });
        
        usuariosTrunfoList.appendChild(usuarioDiv);
    });
}
        
        function carregarRodadasDisponiveis() {
            // Simula√ß√£o de carregamento de rodadas dispon√≠veis
            const listaRodadasElement = document.getElementById('listaRodadas');
            
            listaRodadasElement.innerHTML = '<div style="text-align: center; padding: 20px;">Carregando rodadas...</div>';
            
            setTimeout(() => {
                const rodadasExemplo = [
                    { numero: 1, jogos: 3 },
                    { numero: 2, jogos: 2 },
                    { numero: 3, jogos: 1 },
                    { numero: 4, jogos: 4 },
                    { numero: 5, jogos: 2 }
                ];
                
                listaRodadasElement.innerHTML = '';
                
                rodadasExemplo.forEach(rodada => {
                    const rodadaDiv = document.createElement('div');
                    rodadaDiv.className = 'jogo-item';
                    rodadaDiv.dataset.rodada = rodada.numero;
                    
                    rodadaDiv.innerHTML = `
                        <div class="checkbox"></div>
                        <div class="jogo-times">Rodada ${rodada.numero} (${rodada.jogos} jogos)</div>
                    `;
                    
                    rodadaDiv.addEventListener('click', function() {
                        selecionarRodada(rodada.numero, this);
                    });
                    
                    listaRodadasElement.appendChild(rodadaDiv);
                    
                    // Marca como selecionado se j√° estiver na lista
                    if (rodadasSelecionadas.includes(rodada.numero)) {
                        rodadaDiv.classList.add('selected');
                        rodadaDiv.querySelector('.checkbox').classList.add('selected');
                    }
                });
                
                // Cria as tabs para as rodadas selecionadas
                atualizarTabsRodadas();
            }, 500);
        }
        
        function selecionarJogo(jogoId, element) {
            const tipo = urlParams.get('tipo');
            
            if (tipo === 'unica') {
                // Modo √∫nica rodada
                if (!dadosPorRodada[1]) {
                    dadosPorRodada[1] = { jogos: [], horario: '', dobrada: [], trunfo: [] };
                }
                
                const index = dadosPorRodada[1].jogos.indexOf(jogoId);
                
                if (index === -1) {
                    dadosPorRodada[1].jogos.push(jogoId);
                    element.classList.add('selected');
                    element.querySelector('.checkbox').classList.add('selected');
                } else {
                    dadosPorRodada[1].jogos.splice(index, 1);
                    element.classList.remove('selected');
                    element.querySelector('.checkbox').classList.remove('selected');
                }
            } else {
                // Modo m√∫ltiplas rodadas
                if (!dadosPorRodada[rodadaAtual]) {
                    dadosPorRodada[rodadaAtual] = { jogos: [], horario: '', dobrada: [], trunfo: [] };
                }
                
                const index = dadosPorRodada[rodadaAtual].jogos.indexOf(jogoId);
                
                if (index === -1) {
                    dadosPorRodada[rodadaAtual].jogos.push(jogoId);
                    element.classList.add('selected');
                    element.querySelector('.checkbox').classList.add('selected');
                } else {
                    dadosPorRodada[rodadaAtual].jogos.splice(index, 1);
                    element.classList.remove('selected');
                    element.querySelector('.checkbox').classList.remove('selected');
                }
            }
        }
        
        function selecionarUsuario(usuarioId, element, tipoLista) {
            const tipo = urlParams.get('tipo');
            
            if (tipo === 'unica') {
                // Modo √∫nica rodada
                if (!dadosPorRodada[1]) {
                    dadosPorRodada[1] = { jogos: [], horario: '', dobrada: [], trunfo: [] };
                }
                
                const lista = tipoLista === 'dobrada' ? dadosPorRodada[1].dobrada : dadosPorRodada[1].trunfo;
                const index = lista.indexOf(usuarioId);
                
                if (index === -1) {
                    lista.push(usuarioId);
                    element.classList.add('selected');
                } else {
                    lista.splice(index, 1);
                    element.classList.remove('selected');
                }
            } else {
                // Modo m√∫ltiplas rodadas
                if (!dadosPorRodada[rodadaAtual]) {
                    dadosPorRodada[rodadaAtual] = { jogos: [], horario: '', dobrada: [], trunfo: [] };
                }
                
                const lista = tipoLista === 'dobrada' ? dadosPorRodada[rodadaAtual].dobrada : dadosPorRodada[rodadaAtual].trunfo;
                const index = lista.indexOf(usuarioId);
                
                if (index === -1) {
                    lista.push(usuarioId);
                    element.classList.add('selected');
                } else {
                    lista.splice(index, 1);
                    element.classList.remove('selected');
                }
            }
        }
        
        function selecionarRodada(numeroRodada, element) {
            const index = rodadasSelecionadas.indexOf(numeroRodada);
            
            if (index === -1) {
                rodadasSelecionadas.push(numeroRodada);
                element.classList.add('selected');
                element.querySelector('.checkbox').classList.add('selected');
                
                // Inicializa dados para esta rodada se n√£o existir
                if (!dadosPorRodada[numeroRodada]) {
                    dadosPorRodada[numeroRodada] = { jogos: [], horario: '', dobrada: [], trunfo: [] };
                }
                
                // Se for a primeira rodada selecionada, torna-a ativa
                if (rodadasSelecionadas.length === 1) {
                    rodadaAtual = numeroRodada;
                    carregarDadosRodadaAtual();
                }
            } else {
                rodadasSelecionadas.splice(index, 1);
                element.classList.remove('selected');
                element.querySelector('.checkbox').classList.remove('selected');
                
                // Se a rodada atual foi removida, seleciona outra
                if (numeroRodada === rodadaAtual && rodadasSelecionadas.length > 0) {
                    rodadaAtual = rodadasSelecionadas[0];
                    carregarDadosRodadaAtual();
                } else if (rodadasSelecionadas.length === 0) {
                    // Se n√£o h√° mais rodadas selecionadas, limpa a interface
                    rodadaAtual = null;
                    document.getElementById('listaJogos').innerHTML = '<div style="text-align: center; padding: 20px;">Selecione pelo menos uma rodada</div>';
                    document.getElementById('horarioFechamento').value = '';
                }
            }
            
            atualizarTabsRodadas();
        }
        
        function atualizarTabsRodadas() {
            const rodadaTabsElement = document.getElementById('rodadaTabs');
            rodadaTabsElement.innerHTML = '';
            
            rodadasSelecionadas.sort((a, b) => a - b);
            
            rodadasSelecionadas.forEach(numero => {
                const tab = document.createElement('div');
                tab.className = `rodada-tab ${numero === rodadaAtual ? 'active' : ''}`;
                tab.textContent = `Rodada ${numero}`;
                tab.dataset.rodada = numero;
                
                tab.addEventListener('click', function() {
                    mudarRodadaAtual(numero);
                });
                
                rodadaTabsElement.appendChild(tab);
            });
        }
        
        function mudarRodadaAtual(novaRodada) {
            // Salva dados da rodada atual
            salvarDadosRodadaAtual();
            
            // Altera a rodada atual
            rodadaAtual = novaRodada;
            
            // Carrega dados da nova rodada
            carregarDadosRodadaAtual();
            
            // Atualiza as tabs
            atualizarTabsRodadas();
        }
        
        function salvarDadosRodadaAtual() {
            if (!rodadaAtual || !dadosPorRodada[rodadaAtual]) return;
            
            // Salva hor√°rio
            const horarioInput = document.getElementById('horarioFechamento');
            dadosPorRodada[rodadaAtual].horario = horarioInput.value;
            
            // Nota: Os jogos e usu√°rios j√° s√£o salvos quando selecionados
        }
        
        function carregarDadosRodadaAtual() {
            if (!rodadaAtual) return;
            
            // Carrega hor√°rio
            const horarioInput = document.getElementById('horarioFechamento');
            horarioInput.value = dadosPorRodada[rodadaAtual]?.horario || '';
            
            // Recarrega jogos para mostrar os selecionados desta rodada
            carregarJogos();
            
            // Recarrega usu√°rios para mostrar os selecionados desta rodada
            carregarUsuarios();
        }
        
        function enviarRodada() {
            const tipo = urlParams.get('tipo');
            
            if (tipo === 'unica') {
                // Valida√ß√£o para rodada √∫nica
                if (!dadosPorRodada[1] || dadosPorRodada[1].jogos.length === 0) {
                    alert('Selecione pelo menos um jogo!');
                    return;
                }
                
                if (!document.getElementById('horarioFechamento').value) {
                    alert('Defina um hor√°rio de fechamento!');
                    return;
                }
                
                dadosPorRodada[1].horario = document.getElementById('horarioFechamento').value;
                
                const dadosEnvio = {
                    tipo: 'unica',
                    rodada: 1,
                    jogos: dadosPorRodada[1].jogos,
                    horario: dadosPorRodada[1].horario,
                    dobrada: dadosPorRodada[1].dobrada,
                    trunfo: dadosPorRodada[1].trunfo
                };
                
                enviarParaTelegram(dadosEnvio);
                
            } else {
                // Valida√ß√£o para m√∫ltiplas rodadas
                if (rodadasSelecionadas.length === 0) {
                    alert('Selecione pelo menos uma rodada!');
                    return;
                }
                
                // Salva dados da rodada atual antes de enviar
                salvarDadosRodadaAtual();
                
                // Valida cada rodada
                const rodadasValidas = [];
                
                rodadasSelecionadas.forEach(numero => {
                    const dados = dadosPorRodada[numero];
                    
                    if (!dados || dados.jogos.length === 0) {
                        alert(`Rodada ${numero} n√£o tem jogos selecionados!`);
                        return;
                    }
                    
                    if (!dados.horario) {
                        alert(`Rodada ${numero} n√£o tem hor√°rio definido!`);
                        return;
                    }
                    
                    rodadasValidas.push({
                        rodada: numero,
                        jogos: dados.jogos,
                        horario: dados.horario,
                        dobrada: dados.dobrada,
                        trunfo: dados.trunfo
                    });
                });
                
                if (rodadasValidas.length === 0) return;
                
                const dadosEnvio = {
                    tipo: 'multipla',
                    rodadas: rodadasValidas
                };
                
                enviarParaTelegram(dadosEnvio);
            }
        }
        
        function enviarParaTelegram(dados) {
            if (window.Telegram && Telegram.WebApp) {
                // Envia dados para o bot
                Telegram.WebApp.sendData(JSON.stringify(dados));
                Telegram.WebApp.close();
            } else {
                // Modo de desenvolvimento
                console.log('Dados a enviar:', dados);
                alert('Dados prontos para enviar!\n(Em produ√ß√£o, isso seria enviado ao bot)');
                
                // Simula envio
                setTimeout(() => {
                    window.close();
                }, 1000);
            }
        }
        
        function voltar() {
            if (window.Telegram && Telegram.WebApp) {
                Telegram.WebApp.close();
            } else {
                window.close();
            }
        }
    </script>
</body>
</html>
