<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üèÜ Sistema de Ranking - Bol√£o</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    <style>
        :root {
            --primary-color: #2c3e50;
            --secondary-color: #3498db;
            --success-color: #2ecc71;
            --warning-color: #f39c12;
            --danger-color: #e74c3c;
            --purple-color: #9b59b6;
            --gold-color: #FFD700;
            --silver-color: #C0C0C0;
            --bronze-color: #CD7F32;
            --fourth-color: #3498db;
        }
        
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            padding-bottom: 50px;
        }
        
        .container-main {
            background-color: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            margin-top: 30px;
            margin-bottom: 30px;
            padding: 0;
            overflow: hidden;
        }
        
        .navbar-custom {
            background: linear-gradient(90deg, var(--primary-color), #1a252f);
            color: white;
            border-radius: 0 0 10px 10px;
            padding: 1rem 0;
        }
        
        .navbar-brand {
            font-weight: bold;
            font-size: 1.8rem;
            color: white !important;
        }
        
        .navbar-brand i {
            margin-right: 10px;
        }
        
        .nav-tabs-custom {
            background-color: #f8f9fa;
            border-bottom: 3px solid var(--primary-color);
            padding: 0 20px;
        }
        
        .nav-tabs-custom .nav-link {
            color: var(--primary-color);
            font-weight: 500;
            border: none;
            border-radius: 0;
            padding: 15px 25px;
            transition: all 0.3s;
        }
        
        .nav-tabs-custom .nav-link:hover {
            background-color: rgba(52, 152, 219, 0.1);
        }
        
        .nav-tabs-custom .nav-link.active {
            background-color: var(--primary-color);
            color: white;
            border-bottom: 3px solid var(--warning-color);
        }
        
        .card {
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            margin-bottom: 20px;
            transition: transform 0.3s;
            border: none;
        }
        
        .card:hover {
            transform: translateY(-5px);
        }
        
        .table-custom {
            border-radius: 10px;
            overflow: hidden;
            margin-bottom: 20px;
        }
        
        .table-custom thead {
            background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
            color: white;
        }
        
        .position-cell {
            font-weight: bold;
            text-align: center;
            width: 80px;
        }
        
        .position-1 {
            background: linear-gradient(135deg, var(--gold-color), #FFA500);
            color: white;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto;
        }
        
        .position-2 {
            background: linear-gradient(135deg, var(--silver-color), #A9A9A9);
            color: white;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto;
        }
        
        .position-3 {
            background: linear-gradient(135deg, var(--bronze-color), #8B4513);
            color: white;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto;
        }
        
        .position-4 {
            background: linear-gradient(135deg, var(--fourth-color), #2980b9);
            color: white;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto;
        }
        
        .position-other {
            background-color: #f8f9fa;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto;
            font-weight: bold;
            color: var(--primary-color);
        }
        
        /* ==================== NOVAS CORES PARA LINHAS COMPLETAS ==================== */
        
        /* Top 4 - Cores especiais */
        .row-gold {
            background: linear-gradient(90deg, rgba(255, 215, 0, 0.15), rgba(255, 215, 0, 0.05)) !important;
            border-left: 4px solid var(--gold-color);
        }
        
        .row-silver {
            background: linear-gradient(90deg, rgba(192, 192, 192, 0.15), rgba(192, 192, 192, 0.05)) !important;
            border-left: 4px solid var(--silver-color);
        }
        
        .row-bronze {
            background: linear-gradient(90deg, rgba(205, 127, 50, 0.15), rgba(205, 127, 50, 0.05)) !important;
            border-left: 4px solid var(--bronze-color);
        }
        
        .row-fourth {
            background: linear-gradient(90deg, rgba(52, 152, 219, 0.15), rgba(52, 152, 219, 0.05)) !important;
            border-left: 4px solid var(--fourth-color);
        }
        
        /* Escala de cinza para demais posi√ß√µes (5 em diante) */
        .row-pos-5 { background: linear-gradient(90deg, #f8f9fa, #e9ecef) !important; }
        .row-pos-6 { background: linear-gradient(90deg, #e9ecef, #dee2e6) !important; }
        .row-pos-7 { background: linear-gradient(90deg, #dee2e6, #ced4da) !important; }
        .row-pos-8 { background: linear-gradient(90deg, #ced4da, #adb5bd) !important; }
        .row-pos-9 { background: linear-gradient(90deg, #adb5bd, #6c757d) !important; }
        .row-pos-10 { background: linear-gradient(90deg, #6c757d, #495057) !important; color: white !important; }
        
        /* Para posi√ß√µes acima de 10, cicla entre os √∫ltimos 5 tons */
        .row-pos-11 { background: linear-gradient(90deg, #e9ecef, #dee2e6) !important; }
        .row-pos-12 { background: linear-gradient(90deg, #dee2e6, #ced4da) !important; }
        .row-pos-13 { background: linear-gradient(90deg, #ced4da, #adb5bd) !important; }
        .row-pos-14 { background: linear-gradient(90deg, #adb5bd, #6c757d) !important; }
        .row-pos-15 { background: linear-gradient(90deg, #6c757d, #495057) !important; color: white !important; }
        
        /* Continue o padr√£o para mais posi√ß√µes */
        .row-pos-default { background: #f8f9fa !important; }
        
        /* ==================== FIM DAS NOVAS CORES ==================== */
        
        .badge-pe {
            background-color: var(--warning-color);
            color: white;
            min-width: 50px;
        }
        
        .badge-rc {
            background-color: var(--success-color);
            color: white;
            min-width: 50px;
        }
        
        .badge-vp {
            background-color: #6c757d;
            color: white;
            min-width: 40px;
            font-weight: bold;
        }
        
        .badge-vp-positive {
            background-color: var(--success-color) !important;
        }
        
        .badge-vp-negative {
            background-color: var(--danger-color) !important;
        }
        
        .badge-vp-zero {
            background-color: #6c757d !important;
        }
        
        .stats-container {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }
        
        .btn-primary-custom {
            background: linear-gradient(90deg, var(--secondary-color), var(--primary-color));
            border: none;
            color: white;
            padding: 10px 20px;
            border-radius: 5px;
            font-weight: bold;
            transition: all 0.3s;
        }
        
        .btn-primary-custom:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .btn-telegram {
            background: linear-gradient(90deg, #0088cc, #34b7f1);
            border: none;
            color: white;
            padding: 10px 20px;
            border-radius: 5px;
            font-weight: bold;
            transition: all 0.3s;
        }
        
        .btn-telegram:hover {
            background: linear-gradient(90deg, #006699, #2a9fd8);
            transform: translateY(-2px);
        }
        
        .btn-whatsapp {
            background: linear-gradient(90deg, #25D366, #128C7E);
            border: none;
            color: white;
            padding: 10px 20px;
            border-radius: 5px;
            font-weight: bold;
            transition: all 0.3s;
        }
        
        .btn-whatsapp:hover {
            background: linear-gradient(90deg, #1DA851, #0D7A5F);
            transform: translateY(-2px);
        }
        
        .status-online {
            color: var(--success-color);
            font-weight: bold;
        }
        
        .status-offline {
            color: var(--danger-color);
            font-weight: bold;
        }
        
        .loading-spinner {
            display: none;
            text-align: center;
            padding: 40px;
        }
        
        .rodada-selector {
            max-width: 200px;
        }
        
        .user-card {
            border-left: 4px solid var(--secondary-color);
        }
        
        .user-card.position-1-card {
            border-left-color: var(--gold-color);
        }
        
        .user-card.position-2-card {
            border-left-color: var(--silver-color);
        }
        
        .user-card.position-3-card {
            border-left-color: var(--bronze-color);
        }
        
        .user-card.position-4-card {
            border-left-color: var(--fourth-color);
        }
        
        .header-info {
            background-color: #f8f9fa;
            padding: 15px 20px;
            border-bottom: 1px solid #dee2e6;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
        }
        
        .legendas-container {
            background-color: #f8f9fa;
            padding: 10px 15px;
            border-radius: 8px;
            margin-top: 10px;
            border: 1px solid #dee2e6;
        }
        
        .legenda-item {
            display: inline-flex;
            align-items: center;
            margin-right: 15px;
            font-size: 0.85rem;
        }
        
        .legenda-cor {
            width: 12px;
            height: 12px;
            border-radius: 2px;
            margin-right: 5px;
        }
        
        .legenda-pe {
            background-color: var(--warning-color);
        }
        
        .legenda-rc {
            background-color: var(--success-color);
        }
        
        .legenda-vp-pos {
            background-color: var(--success-color);
        }
        
        .legenda-vp-neg {
            background-color: var(--danger-color);
        }
        
        .legenda-vp-zero {
            background-color: #6c757d;
        }
        
        .last-update {
            color: #6c757d;
            font-size: 0.9rem;
        }
        
        .mobile-only {
            display: none;
        }
        
        /* Estat√≠sticas - Layout 3 colunas */
        .estatisticas-container {
            display: flex;
            gap: 20px;
            margin-top: 20px;
        }
        
        .estatisticas-coluna {
            flex: 1;
        }
        
        .estatisticas-coluna-grande {
            flex: 2;
        }
        
        .estatisticas-card {
            min-height: 300px;
        }
        
        .estatisticas-info {
            padding: 20px;
        }
        
        .estatisticas-item {
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 1px solid #eee;
        }
        
        /* ==================== MODAL PALPITES JOGADOR ==================== */
        .modal-palpites-jogador {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.85);
            z-index: 1061;
            overflow-y: auto;
            backdrop-filter: blur(5px);
        }
        
        .modal-palpites-content {
            background: white;
            margin: 20px auto;
            width: 95%;
            max-width: 900px;
            border-radius: 16px;
            overflow: hidden;
            box-shadow: 0 25px 80px rgba(0,0,0,0.4);
            position: relative;
            animation: modalSlideIn 0.4s ease-out;
            max-height: 90vh;
            display: flex;
            flex-direction: column;
        }
        
        .modal-palpites-header {
            background: linear-gradient(135deg, #2c3e50 0%, #3498db 100%);
            color: white;
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-shrink: 0;
        }
        
        .modal-palpites-body {
            padding: 20px;
            overflow-y: auto;
            flex-grow: 1;
        }
        
        .palpites-container {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            margin-top: 15px;
        }
        
        .jogo-palpite-card {
            background: white;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 10px;
            border-left: 4px solid #dee2e6;
            transition: all 0.3s;
        }
        
        .jogo-palpite-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
        }
        
        .jogo-palpite-card.acerto-pe {
            border-left-color: #FFD700;
            background: linear-gradient(90deg, rgba(255, 215, 0, 0.05), rgba(255, 215, 0, 0.02));
        }
        
        .jogo-palpite-card.acerto-rc {
            border-left-color: #2ecc71;
            background: linear-gradient(90deg, rgba(46, 204, 113, 0.05), rgba(46, 204, 113, 0.02));
        }
        
        .jogo-palpite-card.sem-palpite {
            border-left-color: #95a5a6;
            background: linear-gradient(90deg, rgba(149, 165, 166, 0.05), rgba(149, 165, 166, 0.02));
        }
        
        .palpite-resultado {
            font-weight: bold;
            font-size: 1.1em;
        }
        
        .palpite-pontos {
            font-size: 1.2em;
            font-weight: bold;
        }
        
        .btn-duplo-envio {
            background: linear-gradient(90deg, #25D366, #0088cc);
            border: none;
            color: white;
            padding: 12px 25px;
            border-radius: 8px;
            font-weight: bold;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 10px;
            margin-left: 10px;
        }
        
        .btn-duplo-envio:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.2);
        }
        
        .btn-fechar-modal {
            background: none;
            border: none;
            color: white;
            font-size: 28px;
            cursor: pointer;
            padding: 0;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: all 0.3s;
        }
        
        .btn-fechar-modal:hover {
            background: rgba(255,255,255,0.2);
        }
        
        /* ==================== MODAL TELEGRAM ENVIO ==================== */
        .modal-telegram {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 1060;
            overflow-y: auto;
        }
        
        .modal-telegram-content {
            background: white;
            margin: 30px auto;
            width: 90%;
            max-width: 500px;
            border-radius: 16px;
            overflow: hidden;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            position: relative;
            animation: modalSlideIn 0.3s ease-out;
        }
        
        .modal-telegram-header {
            background: linear-gradient(135deg, #0088cc 0%, #34b7f1 100%);
            color: white;
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .modal-telegram-body {
            padding: 20px;
        }
        
        .preview-imagem {
            border: 2px dashed #dee2e6;
            border-radius: 8px;
            padding: 10px;
            text-align: center;
            margin-bottom: 20px;
            min-height: 200px;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: #f8f9fa;
        }
        
        .preview-imagem img {
            max-width: 100%;
            max-height: 300px;
            border-radius: 5px;
        }
        
        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: translateY(-50px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        /* ==================== NOMES DOS JOGADORES TODOS PRETOS ==================== */
        .jogador-nome-padrao {
            color: #000000 !important; /* Preto para todos */
            text-decoration: none;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            padding: 2px 5px;
            border-radius: 4px;
            display: inline-block;
        }
        
        /* For√ßar preto mesmo para os top 4 */
        .row-gold .jogador-nome-padrao,
        .row-silver .jogador-nome-padrao,
        .row-bronze .jogador-nome-padrao,
        .row-fourth .jogador-nome-padrao { 
            color: #000000 !important;
        }
        
        /* ==================== CORRE√á√ÉO: NOMES DO 10¬∫ PARA BAIXO TAMB√âM PRETOS ==================== */
        /* Remover a regra que colocava branco para posi√ß√µes 10 e 15 */
        .row-pos-10 .jogador-nome-padrao,
        .row-pos-15 .jogador-nome-padrao { 
            color: #000000 !important; /* Mant√©m preto igual aos outros */
        }
        
        .jogador-nome-padrao:hover {
            color: #3498db !important;
            background-color: rgba(52, 152, 219, 0.1);
            text-decoration: underline;
            transform: translateY(-1px);
        }
        
        /* Responsividade */
        @media (max-width: 768px) {
            .desktop-only {
                display: none;
            }
            
            .mobile-only {
                display: block;
            }
            
            .nav-tabs-custom {
                overflow-x: auto;
                flex-wrap: nowrap;
                padding: 0 10px;
            }
            
            .nav-tabs-custom .nav-link {
                padding: 10px 15px;
                font-size: 0.9rem;
            }
            
            .header-info {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }
            
            .estatisticas-container {
                flex-direction: column;
            }
            
            .btn-enviar-imagem {
                margin-top: 10px;
                width: 100%;
            }
            
            .modal-palpites-content {
                width: 98%;
                margin: 10px auto;
                border-radius: 12px;
            }
            
            .btn-duplo-envio {
                padding: 10px 15px;
                font-size: 0.9rem;
                margin-left: 0;
                margin-top: 10px;
                width: 100%;
            }
        }
        
        /* ==================== ESTILO PARA IMAGEM CAPTURADA ==================== */
        .imagem-capturada {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: white;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            max-width: 800px;
            margin: 0 auto;
        }
        
        .imagem-cabecalho {
            background: linear-gradient(90deg, #2c3e50, #1a252f);
            color: white;
            padding: 20px;
            border-radius: 15px 15px 0 0;
        }
        
        .imagem-titulo {
            font-weight: bold;
            font-size: 1.8rem;
            margin: 0;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .imagem-subtitulo {
            font-size: 1rem;
            opacity: 0.9;
            margin-top: 10px;
            padding: 10px 15px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
        }
        
        .imagem-conteudo {
            padding: 25px;
        }
        
        .imagem-rodape {
            background: #f8f9fa;
            padding: 15px 25px;
            border-top: 1px solid #dee2e6;
            text-align: center;
            color: #6c757d;
            font-size: 0.9rem;
        }
        
        .jogo-item-imagem {
            background: white;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 12px;
            border-left: 4px solid #dee2e6;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        
        .jogo-item-imagem.pe {
            border-left-color: #FFD700;
            background: linear-gradient(90deg, rgba(255, 215, 0, 0.05), rgba(255, 215, 0, 0.02));
        }
        
        .jogo-item-imagem.rc {
            border-left-color: #2ecc71;
            background: linear-gradient(90deg, rgba(46, 204, 113, 0.05), rgba(46, 204, 113, 0.02));
        }
        
        .badge-imagem {
            padding: 5px 12px;
            border-radius: 20px;
            font-weight: bold;
            font-size: 0.85rem;
        }
        
        .badge-pe-imagem {
            background-color: #f39c12;
            color: white;
        }
        
        .badge-rc-imagem {
            background-color: #27ae60;
            color: white;
        }
        
        .badge-pontos-imagem {
            background: linear-gradient(90deg, #3498db, #2980b9);
            color: white;
            font-size: 1.1rem;
            padding: 8px 16px;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
            margin: 20px 0;
        }
        
        .stat-item {
            background: white;
            border-radius: 10px;
            padding: 15px;
            text-align: center;
            box-shadow: 0 3px 10px rgba(0,0,0,0.08);
            border: 1px solid #e9ecef;
        }
        
        .stat-valor {
            font-size: 1.8rem;
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .stat-valor.pontos {
            color: #3498db;
        }
        
        .stat-valor.pe {
            color: #f39c12;
        }
        
        .stat-valor.rc {
            color: #27ae60;
        }
        
        .stat-valor.participacao {
            color: #9b59b6;
        }
        
        .stat-label {
            font-size: 0.9rem;
            color: #6c757d;
        }
    </style>
</head>
<body>
    <div class="container container-main">
        <!-- Cabe√ßalho -->
        <nav class="navbar navbar-expand-lg navbar-custom">
            <div class="container-fluid">
                <a class="navbar-brand" href="#">
                    <i class="fas fa-trophy"></i> Sistema de Ranking - Bol√£o
                </a>
                <div class="d-flex align-items-center">
                    <span class="me-3 last-update" id="lastUpdate">√öltima atualiza√ß√£o: --/--/-- --:--</span>
                    <button class="btn btn-light btn-sm me-2" onclick="refreshData()">
                        <i class="fas fa-sync-alt"></i> Atualizar
                    </button>
                    <span class="badge bg-success" id="apiStatus">API: Online</span>
                </div>
            </div>
        </nav>
        
        <!-- Abas de Navega√ß√£o -->
        <ul class="nav nav-tabs nav-tabs-custom" id="mainTabs" role="tablist">
            <li class="nav-item" role="presentation">
                <button class="nav-link active" id="geral-tab" data-bs-toggle="tab" data-bs-target="#geral" type="button" role="tab">
                    <i class="fas fa-chart-line"></i> Ranking Geral
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="rodadas-tab" data-bs-toggle="tab" data-bs-target="#rodadas" type="button" role="tab">
                    <i class="fas fa-calendar-alt"></i> Por Rodada
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="estatisticas-tab" data-bs-toggle="tab" data-bs-target="#estatisticas" type="button" role="tab">
                    <i class="fas fa-chart-pie"></i> Estat√≠sticas
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="config-tab" data-bs-toggle="tab" data-bs-target="#config" type="button" role="tab">
                    <i class="fas fa-cog"></i> Configura√ß√µes
                </button>
            </li>
        </ul>
        
        <!-- Conte√∫do das Abas -->
        <div class="tab-content p-4" id="mainTabsContent">
            
            <!-- ABA 1: RANKING GERAL -->
            <div class="tab-pane fade show active" id="geral" role="tabpanel">
                <div class="header-info">
                    <div>
                        <h4><i class="fas fa-chart-line"></i> Ranking Geral</h4>
                        <div id="totalParticipantesContainer" class="mt-1">
                            <span>Total de participantes: <strong id="totalGeral">0</strong></span>
                        </div>
                    </div>
                    <div class="d-flex align-items-center">
                        <button class="btn btn-telegram me-2" onclick="capturarETelegram('geral')" id="btnEnviarGeral">
                            <i class="fab fa-telegram-plane"></i> Enviar para Grupo
                        </button>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="showOnlyActive" checked>
                            <label class="form-check-label" for="showOnlyActive">Apenas ativos</label>
                        </div>
                    </div>
                </div>
                
                <!-- Loading -->
                <div class="loading-spinner" id="loadingGeral">
                    <div class="spinner-border text-primary" role="status">
                        <span class="visually-hidden">Carregando...</span>
                    </div>
                    <p class="mt-2">Carregando ranking geral...</p>
                </div>
                
                <!-- Tabela Desktop -->
                <div class="desktop-only">
                    <div class="table-responsive" id="tabelaGeralContainer">
                        <table class="table table-hover table-custom" id="tableGeral">
                            <thead>
                                <tr>
                                    <th class="position-cell">Posi√ß√£o</th>
                                    <th>Participante</th>
                                    <th>Pontos</th>
                                    <th>VP</th>
                                    <th>PE</th>
                                    <th>RC</th>
                                    <th>Rodadas</th>
                                </tr>
                            </thead>
                            <tbody id="tableGeralBody">
                                <!-- Dados ser√£o inseridos via JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <!-- Cards Mobile -->
                <div class="mobile-only" id="cardsGeral">
                    <!-- Cards ser√£o inseridos via JavaScript -->
                </div>
                
                <!-- Legendas -->
                <div class="legendas-container">
                    <div class="legenda-item">
                        <span class="legenda-cor legenda-pe"></span>
                        <span>PE - Placar Exato (14 pontos)</span>
                    </div>
                    <div class="legenda-item">
                        <span class="legenda-cor legenda-rc"></span>
                        <span>RC - Resultado Correto (4 pontos)</span>
                    </div>
                    <div class="legenda-item">
                        <span class="legenda-cor legenda-vp-pos"></span>
                        <span>VP +X - Subiu X posi√ß√µes</span>
                    </div>
                    <div class="legenda-item">
                        <span class="legenda-cor legenda-vp-neg"></span>
                        <span>VP -X - Desceu X posi√ß√µes</span>
                    </div>
                    <div class="legenda-item">
                        <span class="legenda-cor legenda-vp-zero"></span>
                        <span>VP 0 - Manteve posi√ß√£o</span>
                    </div>
                    <div class="legenda-item">
                        <span>-</span>
                        <span>VP - - Sem compara√ß√£o (1¬™ rodada)</span>
                    </div>
                </div>
                
                <!-- Bot√£o Enviar para Mobile -->
                <div class="mobile-only text-center mt-3">
                    <button class="btn btn-telegram w-100" onclick="capturarETelegram('geral')">
                        <i class="fab fa-telegram-plane"></i> Enviar Ranking para Grupo
                    </button>
                </div>
            </div>
            
            <!-- ABA 2: RANKING POR RODADA -->
            <div class="tab-pane fade" id="rodadas" role="tabpanel">
                <div class="header-info">
                    <div>
                        <h4><i class="fas fa-calendar-alt"></i> <span id="rodadaTitle">Ranking por Rodada</span></h4>
                        <div class="mt-1">
                            <span id="rodadaInfo">Selecione uma rodada</span>
                        </div>
                    </div>
                    <div class="d-flex align-items-center">
                        <button class="btn btn-telegram me-2" onclick="capturarETelegram('rodada')" id="btnEnviarRodada" style="display: none;">
                            <i class="fab fa-telegram-plane"></i> Enviar para Grupo
                        </button>
                        <div class="d-flex align-items-center">
                            <span class="me-2">Rodada:</span>
                            <select class="form-select form-select-sm rodada-selector" id="rodadaSelect">
                                <option value="" disabled selected>Selecione...</option>
                            </select>
                        </div>
                    </div>
                </div>
                
                <!-- Loading -->
                <div class="loading-spinner" id="loadingRodada">
                    <div class="spinner-border text-primary" role="status">
                        <span class="visually-hidden">Carregando...</span>
                    </div>
                    <p class="mt-2">Carregando dados da rodada...</p>
                </div>
                
                <!-- Tabela Desktop -->
                <div class="desktop-only">
                    <div class="table-responsive" id="tabelaRodadaContainer">
                        <table class="table table-hover table-custom" id="tableRodada">
                            <thead>
                                <tr>
                                    <th class="position-cell">Posi√ß√£o</th>
                                    <th>Participante</th>
                                    <th>Pontos</th>
                                    <th>VP</th>
                                    <th>PE</th>
                                    <th>RC</th>
                                </tr>
                            </thead>
                            <tbody id="tableRodadaBody">
                                <!-- Dados ser√£o inseridos via JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <!-- Cards Mobile -->
                <div class="mobile-only" id="cardsRodada">
                    <!-- Cards ser√£o inseridos via JavaScript -->
                </div>
                
                <!-- Legendas -->
                <div class="legendas-container">
                    <div class="legenda-item">
                        <span class="legenda-cor legenda-pe"></span>
                        <span>PE - Placar Exato (14 pontos)</span>
                    </div>
                    <div class="legenda-item">
                        <span class="legenda-cor legenda-rc"></span>
                        <span>RC - Resultado Correto (4 pontos)</span>
                    </div>
                    <div class="legenda-item">
                        <span class="legenda-cor legenda-vp-pos"></span>
                        <span>VP +X - Subiu X posi√ß√µes</span>
                    </div>
                    <div class="legenda-item">
                        <span class="legenda-cor legenda-vp-neg"></span>
                        <span>VP -X - Desceu X posi√ß√µes</span>
                    </div>
                    <div class="legenda-item">
                        <span class="legenda-cor legenda-vp-zero"></span>
                        <span>VP 0 - Manteve posi√ß√£o</span>
                    </div>
                    <div class="legenda-item">
                        <span>-</span>
                        <span>VP - - Sem compara√ß√£o (1¬™ rodada)</span>
                    </div>
                </div>
                
                <!-- Bot√£o Enviar para Mobile -->
                <div class="mobile-only text-center mt-3">
                    <button class="btn btn-telegram w-100" onclick="capturarETelegram('rodada')" id="btnEnviarRodadaMobile" style="display: none;">
                        <i class="fab fa-telegram-plane"></i> Enviar Rodada para Grupo
                    </button>
                </div>
            </div>
            
            <!-- ABA 3: ESTAT√çSTICAS -->
            <div class="tab-pane fade" id="estatisticas" role="tabpanel">
                <div class="header-info">
                    <h4><i class="fas fa-chart-pie"></i> Estat√≠sticas por Jogador</h4>
                    <div class="d-flex align-items-center">
                        <span class="me-3">Selecione um jogador para ver estat√≠sticas</span>
                    </div>
                </div>
                
                <!-- Container de 3 colunas -->
                <div class="estatisticas-container">
                    <!-- Coluna 1: Lista de Jogadores -->
                    <div class="estatisticas-coluna">
                        <div class="card estatisticas-card">
                            <div class="card-header">
                                <i class="fas fa-users me-2"></i> Jogadores
                            </div>
                            <div class="card-body">
                                <div class="mb-3">
                                    <input type="text" class="form-control mb-2" id="filterJogadores" placeholder="Filtrar jogadores..." onkeyup="filtrarJogadores()">
                                </div>
                                <div class="list-group" id="listaJogadores" style="max-height: 400px; overflow-y: auto;">
                                    <!-- Jogadores ser√£o carregados via JavaScript -->
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Coluna 2: Lista de Rodadas -->
                    <div class="estatisticas-coluna">
                        <div class="card estatisticas-card">
                            <div class="card-header">
                                <i class="fas fa-calendar-alt me-2"></i> Rodadas
                            </div>
                            <div class="card-body">
                                <div class="mb-3">
                                    <select class="form-select" id="tipoEstatisticas" onchange="mudarTipoEstatisticas()">
                                        <option value="geral">Estat√≠sticas Gerais</option>
                                        <option value="rodada">Estat√≠sticas por Rodada</option>
                                    </select>
                                </div>
                                <div id="containerRodadas" style="display: none;">
                                    <select class="form-select mb-3" id="selectRodadaEstatisticas">
                                        <!-- Rodadas ser√£o carregadas via JavaScript -->
                                    </select>
                                    <button class="btn btn-primary-custom w-100" onclick="carregarEstatisticasRodada()">
                                        <i class="fas fa-chart-bar"></i> Carregar Estat√≠sticas
                                    </button>
                                </div>
                                <div id="containerGeral">
                                    <button class="btn btn-primary-custom w-100" onclick="carregarEstatisticasGerais()">
                                        <i class="fas fa-chart-line"></i> Carregar Estat√≠sticas Gerais
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Coluna 3: Estat√≠sticas -->
                    <div class="estatisticas-coluna-grande">
                        <div class="card estatisticas-card">
                            <div class="card-header">
                                <i class="fas fa-chart-bar me-2"></i> Estat√≠sticas
                                <span id="estatisticasTitulo" class="float-end text-muted" style="font-size: 0.9rem;"></span>
                            </div>
                            <div class="card-body">
                                <div class="loading-spinner" id="loadingEstatisticas">
                                    <div class="spinner-border text-primary" role="status">
                                        <span class="visually-hidden">Carregando...</span>
                                    </div>
                                    <p class="mt-2">Carregando estat√≠sticas...</p>
                                </div>
                                
                                <div id="estatisticasConteudo" class="estatisticas-info">
                                    <div class="text-center text-muted py-5">
                                        <i class="fas fa-user-chart fa-3x mb-3"></i>
                                        <p>Selecione um jogador para ver suas estat√≠sticas</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- ABA 4: CONFIGURA√á√ïES -->
            <div class="tab-pane fade" id="config" role="tabpanel">
                <div class="header-info">
                    <h4><i class="fas fa-cog"></i> Configura√ß√µes do Sistema</h4>
                </div>
                
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <div class="card">
                            <div class="card-header">
                                <i class="fas fa-sync-alt me-2"></i> Recalcular Ranking
                            </div>
                            <div class="card-body">
                                <p class="card-text">For√ßar rec√°lculo completo dos rankings.</p>
                                <button class="btn btn-primary-custom" onclick="recalcularRanking()" id="btnRecalcular">
                                    <i class="fas fa-calculator me-2"></i> Recalcular Agora
                                </button>
                                <div class="mt-2" id="recalcularStatus"></div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-md-6 mb-3">
                        <div class="card">
                            <div class="card-header">
                                <i class="fas fa-server me-2"></i> Status da API
                            </div>
                            <div class="card-body">
                                <p><strong>Endpoint:</strong> <code>http://localhost:8002</code></p>
                                <p><strong>Status:</strong> <span id="apiStatusDetail" class="status-online">Verificando...</span></p>
                                <p><strong>√öltima verifica√ß√£o:</strong> <span id="lastApiCheck">--:--:--</span></p>
                                <button class="btn btn-sm btn-outline-primary" onclick="checkApiStatus()">
                                    <i class="fas fa-redo"></i> Verificar Agora
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="row">
                    <div class="col-md-12">
                        <div class="card">
                            <div class="card-header">
                                <i class="fas fa-filter me-2"></i> Filtros e Configura√ß√µes
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-md-4 mb-3">
                                        <label class="form-label">Ordenar por:</label>
                                        <select class="form-select" id="sortBy">
                                            <option value="pontos">Pontos (Padr√£o)</option>
                                            <option value="pe">Placar Exato</option>
                                            <option value="nome">Nome</option>
                                            <option value="rodadas">Rodadas</option>
                                        </select>
                                    </div>
                                    <div class="col-md-4 mb-3">
                                        <label class="form-label">Limitar a:</label>
                                        <select class="form-select" id="limitResults">
                                            <option value="10">10 resultados</option>
                                            <option value="25">25 resultados</option>
                                            <option value="50" selected>50 resultados</option>
                                            <option value="100">100 resultados</option>
                                            <option value="all">Todos</option>
                                        </select>
                                    </div>
                                    <div class="col-md-4 mb-3">
                                        <label class="form-label">Formato de exibi√ß√£o:</label>
                                        <select class="form-select" id="displayFormat">
                                            <option value="tabela">Tabela</option>
                                            <option value="cards">Cards</option>
                                        </select>
                                    </div>
                                </div>
                                
                                <div class="form-check mb-2">
                                    <input class="form-check-input" type="checkbox" id="autoRefresh" checked>
                                    <label class="form-check-label" for="autoRefresh">
                                        Atualiza√ß√£o autom√°tica a cada 30 segundos
                                    </label>
                                </div>
                                
                                <div class="form-check mb-2">
                                    <input class="form-check-input" type="checkbox" id="highlightTop4" checked>
                                    <label class="form-check-label" for="highlightTop4">
                                        Destacar top 4 com cores
                                    </label>
                                </div>
                                
                                <div class="form-check mb-2">
                                    <input class="form-check-input" type="checkbox" id="showDetails" checked>
                                    <label class="form-check-label" for="showDetails">
                                        Mostrar estat√≠sticas detalhadas
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ==================== MODAL: PALPITES JOGADOR ==================== -->
    <div class="modal-palpites-jogador" id="modalPalpitesJogador">
        <div class="modal-palpites-content">
            <div class="modal-palpites-header">
                <div>
                    <h3 style="margin: 0;"><i class="fas fa-user-chart"></i> Palpites do Jogador</h3>
                    <div id="modalJogadorInfo" style="font-size: 0.9rem; opacity: 0.9; margin-top: 5px;">
                        Carregando informa√ß√µes...
                    </div>
                </div>
                <div class="d-flex align-items-center">
                    <button class="btn-duplo-envio" onclick="enviarRankingDuplo()" id="btnEnviarDuplo">
                        <i class="fab fa-telegram-plane"></i> <i class="fab fa-whatsapp"></i> Enviar para Grupo e Privado
                    </button>
                    <button class="btn-fechar-modal" onclick="fecharModalPalpites()">&times;</button>
                </div>
            </div>
            
            <div class="modal-palpites-body">
                <div id="palpitesLoading" class="loading-spinner">
                    <div class="spinner-border text-primary" role="status">
                        <span class="visually-hidden">Carregando...</span>
                    </div>
                    <p class="mt-2">Carregando palpites do jogador...</p>
                </div>
                
                <div id="palpitesContent" style="display: none;">
                    <div class="palpites-container">
                        <h5><i class="fas fa-list"></i> Jogos com Palpite</h5>
                        <div id="listaJogosPalpites">
                            <!-- Jogos ser√£o carregados aqui -->
                        </div>
                        
                        <div class="mt-4">
                            <h5><i class="fas fa-chart-pie"></i> Resumo da Rodada</h5>
                            <div class="row mt-3" id="resumoRodada">
                                <!-- Resumo ser√° carregado aqui -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ==================== MODAL: TELEGRAM ENVIO ==================== -->
    <div class="modal-telegram" id="modalTelegram">
        <div class="modal-telegram-content">
            <div class="modal-telegram-header">
                <h3><i class="fab fa-telegram-plane"></i> Enviar para Telegram</h3>
                <button class="close-modal" onclick="fecharModalTelegram()">&times;</button>
            </div>
            
            <div class="modal-telegram-body">
                <div id="previewContainer" class="preview-imagem">
                    <div id="previewPlaceholder">
                        <i class="fas fa-image fa-3x text-muted mb-3"></i>
                        <p>Gerando preview da imagem...</p>
                    </div>
                    <img id="previewImage" style="display: none;" alt="Preview do Ranking">
                </div>
                
                <div class="mb-3">
                    <label for="mensagemTelegram" class="form-label">Mensagem (opcional):</label>
                    <textarea class="form-control" id="mensagemTelegram" rows="3" placeholder="Adicione uma mensagem para acompanhar o ranking..."></textarea>
                </div>
                
                <div class="d-flex justify-content-between">
                    <button class="btn btn-secondary" onclick="fecharModalTelegram()">
                        <i class="fas fa-times"></i> Cancelar
                    </button>
                    <button class="btn btn-telegram" onclick="enviarParaTelegram()" id="btnEnviarTelegram">
                        <i class="fab fa-telegram-plane"></i> Enviar para Grupo
                    </button>
                </div>
                
                <div class="mt-3" id="statusEnvio"></div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <script>
        // Configura√ß√µes globais
        const API_BASE = window.location.protocol + "//" + window.location.hostname + ":8002";
        const TELEGRAM_TOKEN = "8555107685:AAHoIU-2JvDwnMnr-OKR1D1G67aiuACJuOs";
        const TELEGRAM_GROUP_ID = "-5209609227";
        
        let rankingData = null;
        let rodadasData = {};
        let jogadoresData = [];
        let rodadasList = [];
        let currentModalType = null;
        let currentModalElement = null;
        let currentJogadorSelecionado = null;
        let currentRodadaSelecionada = null;
        
        // Elementos DOM
        const elements = {
            // Cabe√ßalho
            lastUpdate: document.getElementById('lastUpdate'),
            apiStatus: document.getElementById('apiStatus'),
            apiStatusDetail: document.getElementById('apiStatusDetail'),
            lastApiCheck: document.getElementById('lastApiCheck'),
            
            // Ranking Geral
            tableGeralBody: document.getElementById('tableGeralBody'),
            cardsGeral: document.getElementById('cardsGeral'),
            totalGeral: document.getElementById('totalGeral'),
            totalParticipantesContainer: document.getElementById('totalParticipantesContainer'),
            loadingGeral: document.getElementById('loadingGeral'),
            tabelaGeralContainer: document.getElementById('tabelaGeralContainer'),
            
            // Ranking Rodada
            tableRodadaBody: document.getElementById('tableRodadaBody'),
            cardsRodada: document.getElementById('cardsRodada'),
            rodadaSelect: document.getElementById('rodadaSelect'),
            rodadaTitle: document.getElementById('rodadaTitle'),
            rodadaInfo: document.getElementById('rodadaInfo'),
            loadingRodada: document.getElementById('loadingRodada'),
            tabelaRodadaContainer: document.getElementById('tabelaRodadaContainer'),
            btnEnviarRodada: document.getElementById('btnEnviarRodada'),
            btnEnviarRodadaMobile: document.getElementById('btnEnviarRodadaMobile'),
            
            // Estat√≠sticas
            listaJogadores: document.getElementById('listaJogadores'),
            filterJogadores: document.getElementById('filterJogadores'),
            tipoEstatisticas: document.getElementById('tipoEstatisticas'),
            containerRodadas: document.getElementById('containerRodadas'),
            containerGeral: document.getElementById('containerGeral'),
            selectRodadaEstatisticas: document.getElementById('selectRodadaEstatisticas'),
            estatisticasConteudo: document.getElementById('estatisticasConteudo'),
            estatisticasTitulo: document.getElementById('estatisticasTitulo'),
            loadingEstatisticas: document.getElementById('loadingEstatisticas'),
            
            // Configura√ß√µes
            btnRecalcular: document.getElementById('btnRecalcular'),
            recalcularStatus: document.getElementById('recalcularStatus'),
            
            // Modais
            modalTelegram: document.getElementById('modalTelegram'),
            previewImage: document.getElementById('previewImage'),
            previewPlaceholder: document.getElementById('previewPlaceholder'),
            mensagemTelegram: document.getElementById('mensagemTelegram'),
            btnEnviarTelegram: document.getElementById('btnEnviarTelegram'),
            statusEnvio: document.getElementById('statusEnvio'),
            
            // Modal Palpites Jogador
            modalPalpitesJogador: document.getElementById('modalPalpitesJogador'),
            modalJogadorInfo: document.getElementById('modalJogadorInfo'),
            palpitesLoading: document.getElementById('palpitesLoading'),
            palpitesContent: document.getElementById('palpitesContent'),
            listaJogosPalpites: document.getElementById('listaJogosPalpites'),
            resumoRodada: document.getElementById('resumoRodada'),
            btnEnviarDuplo: document.getElementById('btnEnviarDuplo')
        };
        
        // Inicializa√ß√£o
        document.addEventListener('DOMContentLoaded', function() {
            checkApiStatus();
            loadRankingGeral();
            loadJogadores();
            setupEventListeners();
            setupAutoRefresh();
            updateLastUpdateTime();
        });
        
        // Configurar listeners de eventos
        function setupEventListeners() {
            // Quando mudar a rodada selecionada
            elements.rodadaSelect.addEventListener('change', function() {
                if (this.value) {
                    currentRodadaSelecionada = this.value;
                    loadRodadaData(this.value);
                }
            });
            
            // Quando mudar configura√ß√µes
            document.getElementById('sortBy').addEventListener('change', applyFilters);
            document.getElementById('limitResults').addEventListener('change', applyFilters);
            document.getElementById('displayFormat').addEventListener('change', applyFilters);
            document.getElementById('highlightTop4').addEventListener('change', applyFilters);
            document.getElementById('showOnlyActive').addEventListener('change', applyFilters);
            document.getElementById('showDetails').addEventListener('change', applyFilters);
            document.getElementById('autoRefresh').addEventListener('change', setupAutoRefresh);
            
            // Fechar modais ao clicar fora
            elements.modalTelegram.addEventListener('click', function(e) {
                if (e.target === this) {
                    fecharModalTelegram();
                }
            });
            
            elements.modalPalpitesJogador.addEventListener('click', function(e) {
                if (e.target === this) {
                    fecharModalPalpites();
                }
            });
            
            // Fechar modal com ESC
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape') {
                    if (elements.modalTelegram.style.display === 'block') {
                        fecharModalTelegram();
                    } else if (elements.modalPalpitesJogador.style.display === 'block') {
                        fecharModalPalpites();
                    }
                }
            });
        }
        
        // Configurar atualiza√ß√£o autom√°tica
        function setupAutoRefresh() {
            if (autoRefreshInterval) {
                clearInterval(autoRefreshInterval);
            }
            
            if (document.getElementById('autoRefresh').checked) {
                autoRefreshInterval = setInterval(function() {
                    const activeTab = document.querySelector('#mainTabs .nav-link.active').id;
                    if (activeTab === 'geral-tab') {
                        loadRankingGeral();
                    } else if (activeTab === 'rodadas-tab' && elements.rodadaSelect.value) {
                        loadRodadaData(elements.rodadaSelect.value);
                    }
                    checkApiStatus();
                }, 30000); // 30 segundos
            }
        }
        
        // Verificar status da API
        async function checkApiStatus() {
            try {
                const response = await fetch(`${API_BASE}/`);
                if (response.ok) {
                    elements.apiStatus.className = 'badge bg-success';
                    elements.apiStatus.textContent = 'API: Online';
                    elements.apiStatusDetail.className = 'status-online';
                    elements.apiStatusDetail.textContent = '‚úÖ Online';
                } else {
                    throw new Error('API n√£o respondeu corretamente');
                }
            } catch (error) {
                elements.apiStatus.className = 'badge bg-danger';
                elements.apiStatus.textContent = 'API: Offline';
                elements.apiStatusDetail.className = 'status-offline';
                elements.apiStatusDetail.textContent = '‚ùå Offline';
            }
            elements.lastApiCheck.textContent = new Date().toLocaleTimeString();
        }
        
        // Atualizar data/hora da √∫ltima atualiza√ß√£o
        function updateLastUpdateTime() {
            const now = new Date();
            elements.lastUpdate.textContent = `√öltima atualiza√ß√£o: ${now.toLocaleDateString()} ${now.toLocaleTimeString()}`;
        }
        
        // ==============================================
        // RANKING GERAL
        // ==============================================
        
        // Carregar ranking geral
        async function loadRankingGeral() {
            showLoading('geral');
            
            try {
                const response = await fetch(`${API_BASE}/api/ranking-geral`);
                if (!response.ok) throw new Error(`HTTP ${response.status}`);
                
                const data = await response.json();
                rankingData = data.ranking;
                
                renderRankingGeral();
                
                // Preencher dropdown de rodadas
                if (data.ranking.length > 0) {
                    const rodadasDisponiveis = Array.from({length: Math.max(...data.ranking.map(r => r.rodadas))}, (_, i) => i + 1);
                    populateRodadaSelect(rodadasDisponiveis);
                }
                
                // Atualizar total de participantes
                elements.totalGeral.textContent = data.ranking.length;
                elements.totalParticipantesContainer.innerHTML = `
                    <span>Total de participantes: <strong>${data.ranking.length}</strong></span>
                `;
                
            } catch (error) {
                console.error('Erro ao carregar ranking geral:', error);
                elements.tableGeralBody.innerHTML = `
                    <tr>
                        <td colspan="7" class="text-center text-danger">
                            <i class="fas fa-exclamation-triangle"></i> Erro ao carregar dados: ${error.message}
                        </td>
                    </tr>`;
            } finally {
                hideLoading('geral');
                updateLastUpdateTime();
            }
        }
        
        // Renderizar ranking geral
        function renderRankingGeral() {
            if (!rankingData) return;
            
            // Aplicar filtros
            let filteredData = [...rankingData];
            const sortBy = document.getElementById('sortBy').value;
            const limit = document.getElementById('limitResults').value;
            const showOnlyActive = document.getElementById('showOnlyActive').checked;
            const displayFormat = document.getElementById('displayFormat').value;
            const highlightTop4 = document.getElementById('highlightTop4').checked;
            
            // Ordenar
            switch(sortBy) {
                case 'pe':
                    filteredData.sort((a, b) => b.estatisticas.PE - a.estatisticas.PE || b.pontos - a.pontos);
                    break;
                case 'nome':
                    filteredData.sort((a, b) => a.usuario.localeCompare(b.usuario));
                    break;
                case 'rodadas':
                    filteredData.sort((a, b) => b.rodadas - a.rodadas || b.pontos - a.pontos);
                    break;
                default: // pontos
                    filteredData.sort((a, b) => b.pontos - a.pontos);
            }
            
            // Limitar
            if (limit !== 'all') {
                filteredData = filteredData.slice(0, parseInt(limit));
            }
            
            // Renderizar
            if (displayFormat === 'tabela' || window.innerWidth > 768) {
                renderTableGeral(filteredData, highlightTop4);
            } else {
                renderCardsGeral(filteredData, highlightTop4);
            }
        }
        
        // Renderizar tabela geral
        function renderTableGeral(data, highlightTop4) {
            let html = '';
            
            data.forEach((item, index) => {
                let positionClass = 'position-other';
                let positionText = item.posicao || (index + 1);
                let rowClass = getRowClass(positionText);
                
                // Definir classe de posi√ß√£o
                if (positionText === 1) {
                    positionClass = 'position-1';
                } else if (positionText === 2) {
                    positionClass = 'position-2';
                } else if (positionText === 3) {
                    positionClass = 'position-3';
                } else if (positionText === 4 && highlightTop4) {
                    positionClass = 'position-4';
                }
                
                // Calcular VP (Varia√ß√£o de Posi√ß√£o)
                const vp = calcularVP(item);
                const vpClass = getVPClass(vp);
                
                // NOME DO JOGADOR - SEMPRE PRETO
                const nomeJogador = `<strong class="jogador-nome-padrao">${item.usuario}</strong>`;
                
                html += `
                    <tr class="${rowClass}">
                        <td class="position-cell">
                            <div class="${positionClass}">
                                ${positionText}
                            </div>
                        </td>
                        <td>
                            ${nomeJogador}
                            ${positionText <= 3 ? `<span class="badge bg-warning ms-2">TOP ${positionText}</span>` : ''}
                        </td>
                        <td>
                            <span class="badge bg-primary" style="font-size: 1.1em">${item.pontos}</span>
                        </td>
                        <td>
                            <span class="badge badge-vp ${vpClass}">${vp}</span>
                        </td>
                        <td>
                            <span class="badge badge-pe">${item.estatisticas.PE || 0}</span>
                        </td>
                        <td>
                            <span class="badge badge-rc">${item.estatisticas.RC || 0}</span>
                        </td>
                        <td>${item.rodadas}</td>
                    </tr>
                `;
            });
            
            elements.tableGeralBody.innerHTML = html;
        }
        
        // Renderizar cards geral (mobile)
        function renderCardsGeral(data, highlightTop4) {
            let html = '';
            
            data.forEach((item, index) => {
                let positionText = item.posicao || (index + 1);
                let cardClass = 'user-card';
                
                if (positionText === 1) {
                    cardClass += ' position-1-card';
                } else if (positionText === 2) {
                    cardClass += ' position-2-card';
                } else if (positionText === 3) {
                    cardClass += ' position-3-card';
                } else if (positionText === 4 && highlightTop4) {
                    cardClass += ' position-4-card';
                }
                
                // Calcular VP
                const vp = calcularVP(item);
                const vpClass = getVPClass(vp).replace('badge-', '');
                
                html += `
                    <div class="card ${cardClass} mb-3">
                        <div class="card-body">
                            <div class="d-flex justify-content-between align-items-start">
                                <div>
                                    <h5 class="card-title">
                                        ${item.usuario}
                                    </h5>
                                    <h6 class="card-subtitle mb-2 text-muted">${positionText}¬∫ lugar</h6>
                                </div>
                                <div>
                                    <span class="badge bg-primary" style="font-size: 1.2em">${item.pontos} pts</span>
                                </div>
                            </div>
                            <div class="row mt-2">
                                <div class="col-4">
                                    <div class="text-center">
                                        <span class="badge ${vpClass} w-100">${vp}</span>
                                        <small class="text-muted">VP</small>
                                    </div>
                                </div>
                                <div class="col-4">
                                    <div class="text-center">
                                        <span class="badge badge-pe w-100">${item.estatisticas.PE || 0}</span>
                                        <small class="text-muted">PE</small>
                                    </div>
                                </div>
                                <div class="col-4">
                                    <div class="text-center">
                                        <span class="badge badge-rc w-100">${item.estatisticas.RC || 0}</span>
                                        <small class="text-muted">RC</small>
                                    </div>
                                </div>
                            </div>
                            <div class="mt-2">
                                <small class="text-muted">Participou de ${item.rodadas} rodadas</small>
                            </div>
                        </div>
                    </div>
                `;
            });
            
            elements.cardsGeral.innerHTML = html;
        }
        
        // ==============================================
        // RANKING POR RODADA
        // ==============================================
        
        // Preencher dropdown de rodadas
        function populateRodadaSelect(rodadas) {
            let html = '<option value="" disabled selected>Selecione uma rodada</option>';
            rodadas.forEach(rodada => {
                html += `<option value="${rodada}">Rodada ${rodada}</option>`;
            });
            elements.rodadaSelect.innerHTML = html;
            rodadasList = rodadas;
        }
        
        // Carregar dados de uma rodada espec√≠fica
        async function loadRodadaData(rodadaNum) {
            showLoading('rodada');
            
            try {
                const response = await fetch(`${API_BASE}/api/rodada/${rodadaNum}`);
                if (!response.ok) throw new Error(`HTTP ${response.status}`);
                
                const data = await response.json();
                rodadasData[rodadaNum] = data.ranking;
                
                // Atualizar t√≠tulo
                elements.rodadaTitle.textContent = `Rodada ${rodadaNum}`;
                elements.rodadaInfo.textContent = `${data.total} participantes`;
                
                // Mostrar bot√£o de envio
                elements.btnEnviarRodada.style.display = 'block';
                elements.btnEnviarRodadaMobile.style.display = 'block';
                
                renderRodadaData(rodadaNum);
                
            } catch (error) {
                console.error(`Erro ao carregar rodada ${rodadaNum}:`, error);
                elements.tableRodadaBody.innerHTML = `
                    <tr>
                        <td colspan="6" class="text-center text-danger">
                            <i class="fas fa-exclamation-triangle"></i> Erro ao carregar dados da rodada: ${error.message}
                        </td>
                    </tr>`;
            } finally {
                hideLoading('rodada');
                updateLastUpdateTime();
            }
        }
        
        // Renderizar dados da rodada
        function renderRodadaData(rodadaNum) {
            const data = rodadasData[rodadaNum];
            if (!data) return;
            
            // Aplicar filtros
            let filteredData = [...data];
            const sortBy = document.getElementById('sortBy').value;
            const limit = document.getElementById('limitResults').value;
            const displayFormat = document.getElementById('displayFormat').value;
            const highlightTop4 = document.getElementById('highlightTop4').checked;
            
            // Ordenar
            switch(sortBy) {
                case 'pe':
                    filteredData.sort((a, b) => (b.estatisticas.pe || 0) - (a.estatisticas.pe || 0) || b.pontos - a.pontos);
                    break;
                case 'nome':
                    filteredData.sort((a, b) => a.usuario.localeCompare(b.usuario));
                    break;
                default: // pontos
                    filteredData.sort((a, b) => b.pontos - a.pontos);
            }
            
            // Limitar
            if (limit !== 'all') {
                filteredData = filteredData.slice(0, parseInt(limit));
            }
            
            // Renderizar
            if (displayFormat === 'tabela' || window.innerWidth > 768) {
                renderTableRodada(filteredData, rodadaNum, highlightTop4);
            } else {
                renderCardsRodada(filteredData, rodadaNum, highlightTop4);
            }
        }
        
        // Renderizar tabela da rodada
        function renderTableRodada(data, rodadaNum, highlightTop4) {
            let html = '';
            
            data.forEach((item, index) => {
                let positionClass = 'position-other';
                let positionText = item.posicao || (index + 1);
                let rowClass = getRowClass(positionText);
                
                // Definir classe de posi√ß√£o
                if (positionText === 1) {
                    positionClass = 'position-1';
                } else if (positionText === 2) {
                    positionClass = 'position-2';
                } else if (positionText === 3) {
                    positionClass = 'position-3';
                } else if (positionText === 4 && highlightTop4) {
                    positionClass = 'position-4';
                }
                
                // Calcular VP (Varia√ß√£o de Posi√ß√£o)
                const vp = calcularVPRodada(item, rodadaNum);
                const vpClass = getVPClass(vp);
                
                // NOME DO JOGADOR - SEMPRE PRETO, COM CLIQUE PARA ABRIR MODAL
                const nomeJogador = `<span class="jogador-nome-padrao" onclick="abrirModalPalpitesRodada('${item.usuario}', ${rodadaNum}, ${positionText})">${item.usuario}</span>`;
                
                html += `
                    <tr class="${rowClass}">
                        <td class="position-cell">
                            <div class="${positionClass}">
                                ${positionText}
                            </div>
                        </td>
                        <td>
                            ${nomeJogador}
                            ${positionText <= 3 ? `<span class="badge bg-warning ms-2">TOP ${positionText}</span>` : ''}
                        </td>
                        <td><span class="badge bg-primary">${item.pontos}</span></td>
                        <td>
                            <span class="badge badge-vp ${vpClass}">${vp}</span>
                        </td>
                        <td>
                            <span class="badge badge-pe">${item.estatisticas.pe || item.estatisticas.PE || 0}</span>
                        </td>
                        <td>
                            <span class="badge badge-rc">${item.estatisticas.rc || item.estatisticas.RC || 0}</span>
                        </td>
                    </tr>
                `;
            });
            
            elements.tableRodadaBody.innerHTML = html;
        }
        
        // Fun√ß√£o para abrir modal de palpites (apenas na aba rodadas)
        function abrirModalPalpitesRodada(jogadorNome, rodadaNum, posicao) {
            currentJogadorSelecionado = {
                id: jogadorNome,
                nome: jogadorNome,
                tipo: 'rodada',
                posicao: posicao,
                rodada: rodadaNum
            };
            
            // Atualizar informa√ß√µes no modal
            elements.modalJogadorInfo.innerHTML = `
                <strong>${jogadorNome}</strong> ‚Ä¢ ${posicao}¬∫ lugar ‚Ä¢ Rodada ${rodadaNum}
            `;
            
            // Abrir modal
            abrirModalPalpites();
            
            // Carregar palpites do jogador
            carregarPalpitesJogador(jogadorNome, jogadorNome, rodadaNum);
        }
        
        // Renderizar cards da rodada (mobile)
        function renderCardsRodada(data, rodadaNum, highlightTop4) {
            let html = '';
            
            data.forEach((item, index) => {
                let positionText = item.posicao || (index + 1);
                let cardClass = 'user-card';
                
                if (positionText === 1) {
                    cardClass += ' position-1-card';
                } else if (positionText === 2) {
                    cardClass += ' position-2-card';
                } else if (positionText === 3) {
                    cardClass += ' position-3-card';
                } else if (positionText === 4 && highlightTop4) {
                    cardClass += ' position-4-card';
                }
                
                // Calcular VP
                const vp = calcularVPRodada(item, rodadaNum);
                const vpClass = getVPClass(vp).replace('badge-', '');
                
                html += `
                    <div class="card ${cardClass} mb-3">
                        <div class="card-body">
                            <div class="d-flex justify-content-between align-items-start">
                                <div>
                                    <h5 class="card-title" onclick="abrirModalPalpitesRodada('${item.usuario}', ${rodadaNum}, ${positionText})" style="cursor: pointer;">
                                        ${item.usuario}
                                    </h5>
                                    <h6 class="card-subtitle mb-2 text-muted">${positionText}¬∫ lugar</h6>
                                </div>
                                <div>
                                    <span class="badge bg-primary" style="font-size: 1.2em">${item.pontos} pts</span>
                                </div>
                            </div>
                            <div class="row mt-2">
                                <div class="col-3">
                                    <div class="text-center">
                                        <span class="badge ${vpClass} w-100">${vp}</span>
                                        <small class="text-muted">VP</small>
                                    </div>
                                </div>
                                <div class="col-4">
                                    <div class="text-center">
                                        <span class="badge badge-pe w-100">${item.estatisticas.pe || item.estatisticas.PE || 0}</span>
                                        <small class="text-muted">PE</small>
                                    </div>
                                </div>
                                <div class="col-5">
                                    <div class="text-center">
                                        <span class="badge badge-rc w-100">${item.estatisticas.rc || item.estatisticas.RC || 0}</span>
                                        <small class="text-muted">RC</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            });
            
            elements.cardsRodada.innerHTML = html;
        }
        
        // ==============================================
        // MODAL PALPITES JOGADOR
        // ==============================================
        
        // Abrir modal de palpites
        function abrirModalPalpites() {
            elements.modalPalpitesJogador.style.display = 'block';
            document.body.style.overflow = 'hidden';
            elements.palpitesLoading.style.display = 'block';
            elements.palpitesContent.style.display = 'none';
        }
        
        // Fechar modal de palpites
        function fecharModalPalpites() {
            elements.modalPalpitesJogador.style.display = 'none';
            document.body.style.overflow = 'auto';
        }
        
        // Carregar palpites do jogador
        async function carregarPalpitesJogador(jogadorId, jogadorNome, rodadaNum) {
            try {
                const response = await fetch(`${API_BASE}/api/palpites/usuario/${encodeURIComponent(jogadorId)}?rodada=${rodadaNum || ''}`);
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${await response.text()}`);
                }
                
                const data = await response.json();
                
                if (!data.success) {
                    throw new Error('API retornou erro');
                }
                
                // Renderizar palpites
                renderPalpitesJogador(data.dados_webapp);
                
            } catch (error) {
                console.error('‚ùå Erro ao carregar palpites do jogador:', error);
                elements.palpitesLoading.innerHTML = `
                    <div style="color: #e74c3c; text-align: center;">
                        <i class="fas fa-exclamation-triangle fa-3x mb-3"></i>
                        <p>Erro ao carregar palpites</p>
                        <p><small>${error.message}</small></p>
                        <button class="btn btn-primary mt-3" onclick="carregarPalpitesJogador('${jogadorId}', '${jogadorNome}', ${rodadaNum})">
                            <i class="fas fa-redo"></i> Tentar novamente
                        </button>
                    </div>
                `;
            }
        }
        
        // Renderizar palpites do jogador
        function renderPalpitesJogador(dados) {
            const rodada = dados.rodada_detalhada;
            const jogos = rodada.jogos || [];
            
            // Filtrar apenas jogos com palpite (usados pelo jogador)
            const jogosComPalpite = jogos.filter(jogo => jogo.tem_palpite && !jogo.sem_palpite);
            
            // Renderizar lista de jogos
            let jogosHtml = '';
            
            if (jogosComPalpite.length === 0) {
                jogosHtml = `
                    <div class="alert alert-warning">
                        <i class="fas fa-info-circle"></i> Nenhum palpite encontrado para esta rodada.
                    </div>
                `;
            } else {
                jogosComPalpite.forEach(jogo => {
                    const temPlacar = jogo.tem_placar;
                    const placarReal = jogo.pr || '-';
                    const palpite = jogo.pal || '-';
                    const pontos = jogo.pts || 0;
                    const acertos = jogo.ac || [];
                    
                    // Determinar classe do card baseada nos acertos
                    let cardClass = 'jogo-palpite-card';
                    if (acertos.includes('PE')) {
                        cardClass += ' acerto-pe';
                    } else if (acertos.includes('RC')) {
                        cardClass += ' acerto-rc';
                    } else if (palpite === 'c/vim') {
                        cardClass += ' sem-palpite';
                    }
                    
                    jogosHtml += `
                        <div class="${cardClass}">
                            <div class="row">
                                <div class="col-md-8">
                                    <div class="d-flex justify-content-between">
                                        <div>
                                            <strong>${jogo.m} vs ${jogo.v}</strong>
                                            <div class="text-muted small">${formatarData(jogo.dh)}</div>
                                        </div>
                                        <div class="text-end">
                                            ${temPlacar ? `<span class="badge bg-dark">Placar: ${placarReal}</span>` : '<span class="badge bg-secondary">Sem placar</span>'}
                                        </div>
                                    </div>
                                    <div class="mt-2">
                                        <span class="badge ${pontos > 0 ? 'bg-info' : 'bg-secondary'}">Palpite: ${palpite}</span>
                                        ${jogo.pd ? '<span class="badge bg-warning ms-1">PD</span>' : ''}
                                    </div>
                                </div>
                                <div class="col-md-4 text-end">
                                    <div class="palpite-pontos ${pontos > 0 ? 'text-success' : 'text-muted'}">
                                        ${pontos} pts
                                    </div>
                                    <div class="mt-1">
                                        ${acertos.map(acerto => `<span class="badge ${getBadgeAcertoClass(acerto)} me-1">${acerto}</span>`).join('')}
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
                });
            }
            
            elements.listaJogosPalpites.innerHTML = jogosHtml;
            
            // Renderizar resumo da rodada
            const totalPontos = rodada.tp || 0;
            const jogosPalpitados = rodada.jp || 0;
            const totalJogos = rodada.jtf || 0;
            const jogosComPlacar = rodada.jcp || 0;
            
            const estatisticas = rodada.est || {pe: 0, rc: 0, gm: 0, gv: 0, pd_usada: false};
            
            elements.resumoRodada.innerHTML = `
                <div class="col-6 col-md-3">
                    <div class="text-center">
                        <div class="display-6 text-primary">${totalPontos}</div>
                        <div class="text-muted">Pontos Totais</div>
                    </div>
                </div>
                <div class="col-6 col-md-3">
                    <div class="text-center">
                        <div class="display-6 text-success">${estatisticas.pe || 0}</div>
                        <div class="text-muted">Placares Exatos</div>
                    </div>
                </div>
                <div class="col-6 col-md-3">
                    <div class="text-center">
                        <div class="display-6 text-info">${estatisticas.rc || 0}</div>
                        <div class="text-muted">Resultados Corretos</div>
                    </div>
                </div>
                <div class="col-6 col-md-3">
                    <div class="text-center">
                        <div class="display-6 ${jogosPalpitados === totalJogos ? 'text-success' : 'text-warning'}">${jogosPalpitados}/${totalJogos}</div>
                        <div class="text-muted">Jogos Palpitados</div>
                    </div>
                </div>
            `;
            
            // Mostrar conte√∫do
            elements.palpitesLoading.style.display = 'none';
            elements.palpitesContent.style.display = 'block';
        }
        
        // Fun√ß√£o auxiliar para formatar data
        function formatarData(dataString) {
            if (!dataString) return '';
            try {
                const data = new Date(dataString);
                return data.toLocaleDateString('pt-BR', { 
                    day: '2-digit', 
                    month: '2-digit',
                    hour: '2-digit',
                    minute: '2-digit'
                });
            } catch (e) {
                return dataString;
            }
        }
        
        // Fun√ß√£o auxiliar para classe do badge de acerto
        function getBadgeAcertoClass(acerto) {
            switch(acerto) {
                case 'PE': return 'bg-warning';
                case 'RC': return 'bg-success';
                case 'GM': return 'bg-info';
                case 'GV': return 'bg-info';
                case 'PD': return 'bg-danger';
                default: return 'bg-secondary';
            }
        }
        
        // ==============================================
        // ENVIAR PARA GRUPO E PRIVADO (MODAL PALPITES)
        // ==============================================
        
        async function enviarRankingDuplo() {
            if (!currentJogadorSelecionado) {
                alert('Nenhum jogador selecionado');
                return;
            }

            elements.btnEnviarDuplo.disabled = true;
            elements.btnEnviarDuplo.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Enviando...';

            try {
                // 1. FECHAR o modal primeiro
                fecharModalPalpites();
                
                // 2. Esperar um pouco para o DOM se atualizar
                await new Promise(resolve => setTimeout(resolve, 300));
                
                // 3. CRIAR CONTAINER TEMPOR√ÅRIO COM ESTILO IGUAL AO DAS IMAGENS DOS RANKINGS
                const imagemContainer = document.createElement('div');
                imagemContainer.id = 'imagem-capturada-temporaria';
                imagemContainer.className = 'imagem-capturada';
                imagemContainer.style.cssText = `
                    position: absolute;
                    top: -9999px;
                    left: -9999px;
                    width: 800px;
                    background: white;
                    border-radius: 15px;
                    overflow: hidden;
                    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
                    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
                `;
                
                // 4. CRIAR ESTRUTURA DA IMAGEM COM ESTILO CONSISTENTE
                imagemContainer.innerHTML = `
                    <div class="imagem-cabecalho">
                        <div class="imagem-titulo">
                            <i class="fas fa-user-chart"></i> Palpites do Jogador
                        </div>
                        <div class="imagem-subtitulo" id="imagem-jogador-info">
                            <strong>${currentJogadorSelecionado.nome}</strong> ‚Ä¢ ${currentJogadorSelecionado.posicao}¬∫ lugar ‚Ä¢ Rodada ${currentJogadorSelecionado.rodada}
                        </div>
                    </div>
                    <div class="imagem-conteudo">
                        <div id="imagem-jogos-container">
                            <h4 style="color: #2c3e50; margin-bottom: 20px; border-bottom: 2px solid #f0f0f0; padding-bottom: 10px;">
                                <i class="fas fa-list"></i> Jogos com Palpite
                            </h4>
                            <div id="imagem-jogos-lista">
                                <!-- Jogos ser√£o carregados aqui -->
                            </div>
                        </div>
                        
                        <div id="imagem-resumo-container" style="margin-top: 30px;">
                            <h4 style="color: #2c3e50; margin-bottom: 20px; border-bottom: 2px solid #f0f0f0; padding-bottom: 10px;">
                                <i class="fas fa-chart-pie"></i> Resumo da Rodada
                            </h4>
                            <div class="stats-grid" id="imagem-resumo-grid">
                                <!-- Resumo ser√° carregado aqui -->
                            </div>
                        </div>
                        
                        <div id="imagem-estatisticas-container" style="margin-top: 30px;">
                            <h4 style="color: #2c3e50; margin-bottom: 20px; border-bottom: 2px solid #f0f0f0; padding-bottom: 10px;">
                                <i class="fas fa-chart-bar"></i> Estat√≠sticas Detalhadas
                            </h4>
                            <div class="stats-grid" id="imagem-estatisticas-grid">
                                <!-- Estat√≠sticas ser√£o carregadas aqui -->
                            </div>
                        </div>
                    </div>
                    <div class="imagem-rodape">
                        <div>Sistema de Ranking - Bol√£o ‚Ä¢ Rodada ${currentJogadorSelecionado.rodada}</div>
                        <div style="font-size: 0.8em; color: #999; margin-top: 5px;">
                            Gerado em ${new Date().toLocaleDateString('pt-BR')} ${new Date().toLocaleTimeString('pt-BR', {hour: '2-digit', minute:'2-digit'})}
                        </div>
                    </div>
                `;
                
                // Adicionar ao body
                document.body.appendChild(imagemContainer);
                
                // 5. Buscar dados dos palpites
                await carregarEPreencherImagemPalpites(imagemContainer);
                
                // 6. Aguardar renderiza√ß√£o
                await new Promise(resolve => setTimeout(resolve, 500));
                
                // 7. CAPTURAR usando html2canvas
                const canvas = await html2canvas(imagemContainer, {
                    scale: 1.5,
                    backgroundColor: '#ffffff',
                    useCORS: true,
                    logging: false,
                    removeContainer: true
                });
                
                // 8. REMOVER o container tempor√°rio
                document.body.removeChild(imagemContainer);
                
                // 9. Converter para imagem
                const imageData = canvas.toDataURL('image/png');
                
                // 10. Converter para blob
                const blob = await dataURLtoBlob(imageData);
                
                // 11. Buscar telegram_id do jogador
                let telegramId = null;
                try {
                    const responseUser = await fetch(`${API_BASE}/api/usuario/${encodeURIComponent(currentJogadorSelecionado.nome)}`);
                    if (responseUser.ok) {
                        const userData = await responseUser.json();
                        if (userData && userData.id) {
                            const responseTelegram = await fetch(`${API_BASE}/api/usuario/${userData.id}/telegram-id`);
                            if (responseTelegram.ok) {
                                const telegramData = await responseTelegram.json();
                                telegramId = telegramData.telegram_id;
                            }
                        }
                    }
                } catch (error) {
                    console.warn('N√£o foi poss√≠vel buscar telegram_id:', error);
                }
                
                // 12. Mensagens
                const mensagemGrupo = `üìä Palpites de ${currentJogadorSelecionado.nome}\nüèÜ Rodada ${currentJogadorSelecionado.rodada} ‚Ä¢ ${currentJogadorSelecionado.posicao}¬∫ lugar`;
                const mensagemPrivado = `üìä Seus palpites da Rodada ${currentJogadorSelecionado.rodada}\nüèÜ Voc√™ est√° em ${currentJogadorSelecionado.posicao}¬∫ lugar!`;
                
                // 13. Enviar para grupo
                const formDataGrupo = new FormData();
                formDataGrupo.append('chat_id', TELEGRAM_GROUP_ID);
                formDataGrupo.append('caption', mensagemGrupo);
                formDataGrupo.append('photo', blob, `palpites_${currentJogadorSelecionado.nome}_rodada${currentJogadorSelecionado.rodada}.png`);
                
                const responseGrupo = await fetch(`https://api.telegram.org/bot${TELEGRAM_TOKEN}/sendPhoto`, {
                    method: 'POST',
                    body: formDataGrupo
                });
                
                let resultado = '‚ùå Erro ao enviar para o grupo';
                
                if (responseGrupo.ok) {
                    resultado = '‚úÖ Enviado para o grupo';
                    
                    // 14. Tentar enviar privado se tiver telegram_id
                    if (telegramId) {
                        const formDataPrivado = new FormData();
                        formDataPrivado.append('chat_id', telegramId);
                        formDataPrivado.append('caption', mensagemPrivado);
                        formDataPrivado.append('photo', blob, `seus_palpites_rodada${currentJogadorSelecionado.rodada}.png`);
                        
                        try {
                            await fetch(`https://api.telegram.org/bot${TELEGRAM_TOKEN}/sendPhoto`, {
                                method: 'POST',
                                body: formDataPrivado
                            });
                            resultado += ' e para o jogador!';
                        } catch (error) {
                            resultado += ' (mas falhou no envio privado)';
                        }
                    } else {
                        resultado += ' (jogador n√£o tem telegram_id cadastrado)';
                    }
                }
                
                alert(resultado);
                
            } catch (error) {
                console.error('Erro completo:', error);
                alert(`‚ùå Erro: ${error.message}`);
                
                // Limpar container tempor√°rio se existir
                const tempDiv = document.getElementById('imagem-capturada-temporaria');
                if (tempDiv) {
                    document.body.removeChild(tempDiv);
                }
            } finally {
                elements.btnEnviarDuplo.disabled = false;
                elements.btnEnviarDuplo.innerHTML = '<i class="fab fa-telegram-plane"></i> <i class="fab fa-whatsapp"></i> Enviar para Grupo e Privado';
                
                // Reabrir o modal original
                abrirModalPalpites();
            }
        }

        // Fun√ß√£o para carregar e preencher a imagem com os palpites
        async function carregarEPreencherImagemPalpites(container) {
            try {
                const response = await fetch(`${API_BASE}/api/palpites/usuario/${encodeURIComponent(currentJogadorSelecionado.nome)}?rodada=${currentJogadorSelecionado.rodada}`);
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}`);
                }
                
                const data = await response.json();
                
                if (!data.success) {
                    throw new Error('API retornou erro');
                }
                
                const rodada = data.dados_webapp.rodada_detalhada;
                const jogos = rodada.jogos || [];
                const jogosComPalpite = jogos.filter(jogo => jogo.tem_palpite && !jogo.sem_palpite);
                
                // ========== PREENCHER JOGOS ==========
                let jogosHtml = '';
                
                if (jogosComPalpite.length === 0) {
                    jogosHtml = `
                        <div style="background: #fff3cd; padding: 15px; border-radius: 8px; border: 1px solid #ffeaa7; text-align: center; color: #856404;">
                            <i class="fas fa-info-circle"></i> Nenhum palpite encontrado para esta rodada.
                        </div>
                    `;
                } else {
                    jogosComPalpite.forEach(jogo => {
                        const palpite = jogo.pal || '-';
                        const placarReal = jogo.pr || '-';
                        const pontos = jogo.pts || 0;
                        const acertos = jogo.ac || [];
                        
                        // Determinar classe do item baseada nos acertos
                        let itemClass = 'jogo-item-imagem';
                        let borderColor = '#dee2e6';
                        
                        if (acertos.includes('PE')) {
                            itemClass += ' pe';
                            borderColor = '#FFD700';
                        } else if (acertos.includes('RC')) {
                            itemClass += ' rc';
                            borderColor = '#2ecc71';
                        } else if (palpite === 'c/vim') {
                            borderColor = '#95a5a6';
                        }
                        
                        // Criar badges de acertos
                        let acertosHtml = '';
                        if (acertos.length > 0) {
                            acertosHtml = acertos.map(a => {
                                let badgeColor = '#3498db';
                                if (a === 'PE') badgeColor = '#f39c12';
                                if (a === 'RC') badgeColor = '#27ae60';
                                if (a === 'PD') badgeColor = '#e74c3c';
                                return `<span style="background: ${badgeColor}; color: white; padding: 3px 10px; border-radius: 12px; font-size: 0.8em; margin-left: 5px;">${a}</span>`;
                            }).join('');
                        }
                        
                        jogosHtml += `
                            <div class="${itemClass}" style="border-left-color: ${borderColor}">
                                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                                    <div style="font-weight: bold; font-size: 1.1em; color: #2c3e50;">
                                        ${jogo.m} vs ${jogo.v}
                                    </div>
                                    <div>
                                        <span style="background: ${pontos > 0 ? '#3498db' : '#6c757d'}; color: white; padding: 5px 12px; border-radius: 15px; font-weight: bold;">
                                            ${pontos} pts
                                        </span>
                                    </div>
                                </div>
                                <div style="color: #666; font-size: 0.9em; margin-bottom: 8px;">
                                    <span>Palpite: <strong>${palpite}</strong></span>
                                    ${jogo.pd ? '<span style="background: #e74c3c; color: white; padding: 2px 8px; border-radius: 10px; font-size: 0.8em; margin-left: 8px;">PD</span>' : ''}
                                    <span style="margin-left: 15px;">Placar: <strong>${placarReal}</strong></span>
                                </div>
                                <div>
                                    ${acertosHtml || '<span style="color: #999; font-size: 0.85em;">Sem acertos</span>'}
                                </div>
                                <div style="color: #888; font-size: 0.8em; margin-top: 5px;">
                                    ${formatarData(jogo.dh)}
                                </div>
                            </div>
                        `;
                    });
                }
                
                const jogosListaDiv = container.querySelector('#imagem-jogos-lista');
                if (jogosListaDiv) {
                    jogosListaDiv.innerHTML = jogosHtml;
                }
                
                // ========== PREENCHER RESUMO ==========
                const totalPontos = rodada.tp || 0;
                const jogosPalpitados = rodada.jp || 0;
                const totalJogos = rodada.jtf || 0;
                const estatisticas = rodada.est || {pe: 0, rc: 0, gm: 0, gv: 0, pd_usada: false};
                
                const resumoHtml = `
                    <div class="stat-item">
                        <div class="stat-valor pontos">${totalPontos}</div>
                        <div class="stat-label">Pontos Totais</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-valor pe">${estatisticas.pe || 0}</div>
                        <div class="stat-label">Placares Exatos</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-valor rc">${estatisticas.rc || 0}</div>
                        <div class="stat-label">Resultados Corretos</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-valor participacao" style="color: ${jogosPalpitados === totalJogos ? '#27ae60' : '#e74c3c'}">
                            ${jogosPalpitados}/${totalJogos}
                        </div>
                        <div class="stat-label">Jogos Palpitados</div>
                    </div>
                `;
                
                const resumoGridDiv = container.querySelector('#imagem-resumo-grid');
                if (resumoGridDiv) {
                    resumoGridDiv.innerHTML = resumoHtml;
                }
                
                // ========== PREENCHER ESTAT√çSTICAS DETALHADAS ==========
                const percentualPalpites = totalJogos > 0 ? Math.round((jogosPalpitados / totalJogos) * 100) : 0;
                const mediaPontosPorJogo = jogosPalpitados > 0 ? (totalPontos / jogosPalpitados).toFixed(1) : '0.0';
                const aproveitamentoPE = jogosPalpitados > 0 ? Math.round((estatisticas.pe / jogosPalpitados) * 100) : 0;
                const aproveitamentoRC = jogosPalpitados > 0 ? Math.round((estatisticas.rc / jogosPalpitados) * 100) : 0;
                
                const estatisticasHtml = `
                    <div class="stat-item">
                        <div class="stat-valor" style="color: #9b59b6;">${percentualPalpites}%</div>
                        <div class="stat-label">Participa√ß√£o</div>
                        <div style="font-size: 0.8em; color: #888; margin-top: 5px;">${jogosPalpitados} de ${totalJogos}</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-valor" style="color: #3498db;">${mediaPontosPorJogo}</div>
                        <div class="stat-label">M√©dia por Jogo</div>
                        <div style="font-size: 0.8em; color: #888; margin-top: 5px;">pontos por palpite</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-valor" style="color: #f39c12;">${aproveitamentoPE}%</div>
                        <div class="stat-label">Aproveitamento PE</div>
                        <div style="font-size: 0.8em; color: #888; margin-top: 5px;">${estatisticas.pe || 0} acertos</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-valor" style="color: #27ae60;">${aproveitamentoRC}%</div>
                        <div class="stat-label">Aproveitamento RC</div>
                        <div style="font-size: 0.8em; color: #888; margin-top: 5px;">${estatisticas.rc || 0} acertos</div>
                    </div>
                `;
                
                const estatisticasGridDiv = container.querySelector('#imagem-estatisticas-grid');
                if (estatisticasGridDiv) {
                    estatisticasGridDiv.innerHTML = estatisticasHtml;
                }
                
            } catch (error) {
                console.error('Erro ao carregar informa√ß√µes para imagem:', error);
                
                const erroHtml = `
                    <div style="background: #fee; color: #c00; padding: 15px; border-radius: 8px; border: 1px solid #fcc; text-align: center;">
                        <i class="fas fa-exclamation-triangle"></i> Erro ao carregar dados: ${error.message}
                    </div>
                `;
                
                const jogosListaDiv = container.querySelector('#imagem-jogos-lista');
                if (jogosListaDiv) jogosListaDiv.innerHTML = erroHtml;
                
                const resumoGridDiv = container.querySelector('#imagem-resumo-grid');
                if (resumoGridDiv) resumoGridDiv.innerHTML = erroHtml;
                
                const estatisticasGridDiv = container.querySelector('#imagem-estatisticas-grid');
                if (estatisticasGridDiv) estatisticasGridDiv.innerHTML = erroHtml;
            }
        }
        
        // ==============================================
        // TELEGRAM - CAPTURA E ENVIO DE IMAGEM DOS RANKINGS
        // ==============================================
        
        // Capturar e abrir modal Telegram
        async function capturarETelegram(tipo) {
            currentModalType = tipo;
            
            // Determinar qual elemento capturar
            if (tipo === 'geral') {
                currentModalElement = elements.tabelaGeralContainer;
            } else if (tipo === 'rodada') {
                currentModalElement = elements.tabelaRodadaContainer;
            } else {
                alert('Tipo de captura n√£o suportado');
                return;
            }
            
            // Abrir modal
            abrirModalTelegram();
            
            // Gerar preview
            await gerarPreviewImagem();
        }
        
        // Abrir modal Telegram
        function abrirModalTelegram() {
            elements.modalTelegram.style.display = 'block';
            document.body.style.overflow = 'hidden';
            elements.previewImage.style.display = 'none';
            elements.previewPlaceholder.style.display = 'block';
            elements.statusEnvio.innerHTML = '';
        }
        
        // Fechar modal Telegram
        function fecharModalTelegram() {
            elements.modalTelegram.style.display = 'none';
            document.body.style.overflow = 'auto';
        }
        
        // Gerar preview da imagem
        async function gerarPreviewImagem() {
            try {
                // Criar um container estilizado para a imagem
                const containerEstilizado = document.createElement('div');
                containerEstilizado.className = 'imagem-capturada';
                containerEstilizado.style.cssText = `
                    position: absolute;
                    top: -9999px;
                    left: -9999px;
                    width: 800px;
                    background: white;
                    border-radius: 15px;
                    overflow: hidden;
                    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
                `;
                
                // Clonar o conte√∫do da tabela
                const conteudoClone = currentModalElement.cloneNode(true);
                
                // Adicionar cabe√ßalho
                let titulo = '';
                if (currentModalType === 'geral') {
                    titulo = 'üèÜ Ranking Geral';
                } else if (currentModalType === 'rodada') {
                    titulo = `üìä Rodada ${elements.rodadaSelect.value}`;
                }
                
                containerEstilizado.innerHTML = `
                    <div class="imagem-cabecalho">
                        <div class="imagem-titulo">
                            <i class="fas fa-trophy"></i> Sistema de Ranking - Bol√£o
                        </div>
                        <div class="imagem-subtitulo">
                            ${titulo} ‚Ä¢ ${new Date().toLocaleDateString('pt-BR')}
                        </div>
                    </div>
                    <div class="imagem-conteudo">
                        ${conteudoClone.innerHTML}
                    </div>
                    <div class="imagem-rodape">
                        Sistema de Ranking - Bol√£o ‚Ä¢ Atualizado em ${new Date().toLocaleTimeString('pt-BR', {hour: '2-digit', minute:'2-digit'})}
                    </div>
                `;
                
                document.body.appendChild(containerEstilizado);
                
                // Capturar elemento como imagem
                const canvas = await html2canvas(containerEstilizado, {
                    scale: 1.5,
                    backgroundColor: '#ffffff',
                    useCORS: true,
                    logging: false,
                    removeContainer: true
                });
                
                // Remover container tempor√°rio
                document.body.removeChild(containerEstilizado);
                
                // Converter para data URL
                const imageData = canvas.toDataURL('image/png');
                
                // Mostrar preview
                elements.previewImage.src = imageData;
                elements.previewImage.style.display = 'block';
                elements.previewPlaceholder.style.display = 'none';
                
                // Armazenar imagem para envio
                sessionStorage.setItem('imagemCapturada', imageData);
                
            } catch (error) {
                console.error('Erro ao capturar imagem:', error);
                elements.previewPlaceholder.innerHTML = `
                    <div class="text-danger">
                        <i class="fas fa-exclamation-triangle fa-2x"></i>
                        <p>Erro ao gerar imagem: ${error.message}</p>
                    </div>
                `;
            }
        }
        
        // Enviar para Telegram
        async function enviarParaTelegram() {
            const imagemData = sessionStorage.getItem('imagemCapturada');
            const mensagem = elements.mensagemTelegram.value.trim();
            
            if (!imagemData) {
                alert('Nenhuma imagem para enviar. Tente capturar novamente.');
                return;
            }
            
            elements.btnEnviarTelegram.disabled = true;
            elements.btnEnviarTelegram.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Enviando...';
            elements.statusEnvio.innerHTML = '<div class="alert alert-info">Enviando para Telegram...</div>';
            
            try {
                // Converter data URL para blob
                const blob = await dataURLtoBlob(imagemData);
                
                // Criar form data
                const formData = new FormData();
                formData.append('chat_id', TELEGRAM_GROUP_ID);
                
                let caption = '';
                if (currentModalType === 'geral') {
                    caption = 'üèÜ Ranking Geral do Bol√£o';
                } else if (currentModalType === 'rodada') {
                    caption = `üìä Rodada ${elements.rodadaSelect.value} - Ranking`;
                }
                
                if (mensagem) {
                    caption += '\n' + mensagem;
                }
                
                formData.append('caption', caption);
                formData.append('photo', blob, 'ranking.png');
                
                // Enviar para API do Telegram
                const response = await fetch(`https://api.telegram.org/bot${TELEGRAM_TOKEN}/sendPhoto`, {
                    method: 'POST',
                    body: formData
                });
                
                const result = await response.json();
                
                if (result.ok) {
                    elements.statusEnvio.innerHTML = '<div class="alert alert-success">‚úÖ Imagem enviada com sucesso para o grupo!</div>';
                    
                    // Fechar modal ap√≥s 2 segundos
                    setTimeout(() => {
                        fecharModalTelegram();
                    }, 2000);
                } else {
                    throw new Error(result.description || 'Erro ao enviar para Telegram');
                }
                
            } catch (error) {
                console.error('Erro ao enviar para Telegram:', error);
                elements.statusEnvio.innerHTML = `<div class="alert alert-danger">‚ùå Erro ao enviar: ${error.message}</div>`;
            } finally {
                elements.btnEnviarTelegram.disabled = false;
                elements.btnEnviarTelegram.innerHTML = '<i class="fab fa-telegram-plane"></i> Enviar para Grupo';
            }
        }
        
        // Converter data URL para blob
        function dataURLtoBlob(dataurl) {
            return new Promise((resolve, reject) => {
                const arr = dataurl.split(',');
                const mime = arr[0].match(/:(.*?);/)[1];
                const bstr = atob(arr[1]);
                let n = bstr.length;
                const u8arr = new Uint8Array(n);
                
                while (n--) {
                    u8arr[n] = bstr.charCodeAt(n);
                }
                
                resolve(new Blob([u8arr], {type: mime}));
            });
        }
        
        // ==============================================
        // FUN√á√ïES RESTANTES
        // ==============================================
        
        // Aplicar filtros
        function applyFilters() {
            const activeTab = document.querySelector('#mainTabs .nav-link.active').id;
            
            if (activeTab === 'geral-tab') {
                renderRankingGeral();
            } else if (activeTab === 'rodadas-tab' && elements.rodadaSelect.value) {
                renderRodadaData(elements.rodadaSelect.value);
            }
        }
        
        // Recalcular ranking
        async function recalcularRanking() {
            const btn = elements.btnRecalcular;
            const originalText = btn.innerHTML;
            
            btn.disabled = true;
            btn.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i> Calculando...';
            elements.recalcularStatus.innerHTML = '<div class="alert alert-info">Recalculando rankings...</div>';
            
            try {
                const response = await fetch(`${API_BASE}/api/calcular`);
                if (!response.ok) throw new Error(`HTTP ${response.status}`);
                
                const result = await response.json();
                
                if (result.status.includes('‚úÖ')) {
                    elements.recalcularStatus.innerHTML = '<div class="alert alert-success">‚úÖ Rankings recalculados com sucesso!</div>';
                    // Recarregar dados ap√≥s c√°lculo
                    setTimeout(() => {
                        loadRankingGeral();
                        loadJogadores();
                        if (elements.rodadaSelect.value) {
                            loadRodadaData(elements.rodadaSelect.value);
                        }
                    }, 1000);
                } else {
                    throw new Error(result.status);
                }
                
            } catch (error) {
                console.error('Erro ao recalcular:', error);
                elements.recalcularStatus.innerHTML = `<div class="alert alert-danger">‚ùå Erro ao recalcular: ${error.message}</div>`;
            } finally {
                setTimeout(() => {
                    btn.disabled = false;
                    btn.innerHTML = originalText;
                }, 3000);
            }
        }
        
        // Atualizar todos os dados
        function refreshData() {
            checkApiStatus();
            
            const activeTab = document.querySelector('#mainTabs .nav-link.active').id;
            if (activeTab === 'geral-tab') {
                loadRankingGeral();
            } else if (activeTab === 'rodadas-tab') {
                if (elements.rodadaSelect.value) {
                    loadRodadaData(elements.rodadaSelect.value);
                } else {
                    loadRankingGeral(); // Para carregar as rodadas dispon√≠veis
                }
            } else if (activeTab === 'estatisticas-tab') {
                loadRankingGeral();
                loadJogadores();
            }
        }
        
        // Mostrar loading
        function showLoading(tipo) {
            if (tipo === 'geral') {
                elements.loadingGeral.style.display = 'block';
                elements.tableGeralBody.innerHTML = '';
                elements.cardsGeral.innerHTML = '';
            } else if (tipo === 'rodada') {
                elements.loadingRodada.style.display = 'block';
                elements.tableRodadaBody.innerHTML = '';
                elements.cardsRodada.innerHTML = '';
            } else if (tipo === 'estatisticas') {
                elements.loadingEstatisticas.style.display = 'block';
                elements.estatisticasConteudo.innerHTML = '';
            }
        }
        
        // Esconder loading
        function hideLoading(tipo) {
            if (tipo === 'geral') {
                elements.loadingGeral.style.display = 'none';
            } else if (tipo === 'rodada') {
                elements.loadingRodada.style.display = 'none';
            } else if (tipo === 'estatisticas') {
                elements.loadingEstatisticas.style.display = 'none';
            }
        }
        
        // Carregar lista de jogadores
        async function loadJogadores() {
            try {
                const response = await fetch(`${API_BASE}/api/ranking-geral`);
                if (!response.ok) throw new Error(`HTTP ${response.status}`);
                
                const data = await response.json();
                jogadoresData = data.ranking;
                
                renderListaJogadores();
                populateRodadasEstatisticas();
                
            } catch (error) {
                console.error('Erro ao carregar jogadores:', error);
                elements.listaJogadores.innerHTML = `
                    <div class="alert alert-danger">
                        <i class="fas fa-exclamation-triangle"></i> Erro ao carregar jogadores
                    </div>
                `;
            }
        }
        
        function renderListaJogadores() {
            let html = '';
            
            jogadoresData.forEach((jogador, index) => {
                html += `
                    <a href="#" class="list-group-item list-group-item-action" onclick="selecionarJogador('${jogador.usuario_id || jogador.usuario}', '${jogador.usuario}')">
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <strong>${jogador.usuario}</strong>
                                <div class="text-muted small">
                                    ${jogador.posicao || (index + 1)}¬∫ lugar ‚Ä¢ ${jogador.pontos} pontos
                                </div>
                            </div>
                            <span class="badge bg-primary">${jogador.rodadas} rodadas</span>
                        </div>
                    </a>
                `;
            });
            
            elements.listaJogadores.innerHTML = html;
        }
        
        function filtrarJogadores() {
            const filtro = elements.filterJogadores.value.toLowerCase();
            const itens = elements.listaJogadores.getElementsByClassName('list-group-item');
            
            for (let item of itens) {
                const texto = item.textContent.toLowerCase();
                if (texto.includes(filtro)) {
                    item.style.display = 'block';
                } else {
                    item.style.display = 'none';
                }
            }
        }
        
        function populateRodadasEstatisticas() {
            let html = '<option value="" disabled selected>Selecione uma rodada</option>';
            
            if (rodadasList.length > 0) {
                rodadasList.forEach(rodada => {
                    html += `<option value="${rodada}">Rodada ${rodada}</option>`;
                });
            } else {
                html += '<option value="" disabled>Nenhuma rodada dispon√≠vel</option>';
            }
            
            elements.selectRodadaEstatisticas.innerHTML = html;
        }
        
        function mudarTipoEstatisticas() {
            const tipo = elements.tipoEstatisticas.value;
            
            if (tipo === 'rodada') {
                elements.containerRodadas.style.display = 'block';
                elements.containerGeral.style.display = 'none';
            } else {
                elements.containerRodadas.style.display = 'none';
                elements.containerGeral.style.display = 'block';
            }
        }
        
        function selecionarJogador(jogadorId, jogadorNome) {
            // Remover sele√ß√£o anterior
            const itens = elements.listaJogadores.getElementsByClassName('list-group-item');
            for (let item of itens) {
                item.classList.remove('active');
            }
            
            // Adicionar sele√ß√£o atual
            event.currentTarget.classList.add('active');
            
            // Armazenar jogador selecionado
            sessionStorage.setItem('jogadorSelecionadoId', jogadorId);
            sessionStorage.setItem('jogadorSelecionadoNome', jogadorNome);
            
            // Atualizar t√≠tulo
            elements.estatisticasTitulo.textContent = `Jogador: ${jogadorNome}`;
            
            // Se for estat√≠sticas gerais, carregar automaticamente
            if (elements.tipoEstatisticas.value === 'geral') {
                carregarEstatisticasGerais();
            }
        }
        
        async function carregarEstatisticasGerais() {
            const jogadorId = sessionStorage.getItem('jogadorSelecionadoId');
            const jogadorNome = sessionStorage.getItem('jogadorSelecionadoNome');
            
            if (!jogadorId) {
                alert('Por favor, selecione um jogador primeiro.');
                return;
            }
            
            showLoading('estatisticas');
            
            try {
                // Buscar estat√≠sticas do jogador no ranking geral
                const jogador = jogadoresData.find(j => (j.usuario_id || j.usuario) === jogadorId);
                
                if (!jogador) {
                    throw new Error('Jogador n√£o encontrado');
                }
                
                // Calcular m√©dia de pontos
                const mediaPontos = jogador.rodadas > 0 ? (jogador.pontos / jogador.rodadas).toFixed(1) : '0.0';
                
                // Calcular VP
                const vp = calcularVP(jogador);
                const vpClass = getVPClass(vp).replace('badge-', '');
                
                // Renderizar estat√≠sticas
                elements.estatisticasConteudo.innerHTML = `
                    <div class="text-center mb-4">
                        <div class="display-4 text-primary">${jogador.posicao || '?'}¬∫</div>
                        <h5>Posi√ß√£o Geral</h5>
                    </div>
                    
                    <div class="row text-center mb-4">
                        <div class="col-4">
                            <div class="display-6">${jogador.pontos}</div>
                            <div class="text-muted">Pontos Totais</div>
                        </div>
                        <div class="col-4">
                            <div class="display-6">${mediaPontos}</div>
                            <div class="text-muted">M√©dia/Rodada</div>
                        </div>
                        <div class="col-4">
                            <div class="display-6">${jogador.rodadas}</div>
                            <div class="text-muted">Rodadas</div>
                        </div>
                    </div>
                    
                    <div class="estatisticas-item">
                        <h6><i class="fas fa-star text-warning"></i> Placar Exato (PE)</h6>
                        <div class="d-flex justify-content-between">
                            <span>Total de PE:</span>
                            <span class="badge badge-pe">${jogador.estatisticas.PE || 0}</span>
                        </div>
                        <div class="d-flex justify-content-between">
                            <span>M√©dia por rodada:</span>
                            <span>${(jogador.estatisticas.PE / jogador.rodadas || 0).toFixed(2)}</span>
                        </div>
                    </div>
                    
                    <div class="estatisticas-item">
                        <h6><i class="fas fa-check-circle text-success"></i> Resultado Correto (RC)</h6>
                        <div class="d-flex justify-content-between">
                            <span>Total de RC:</span>
                            <span class="badge badge-rc">${jogador.estatisticas.RC || 0}</span>
                        </div>
                        <div class="d-flex justify-content-between">
                            <span>M√©dia por rodada:</span>
                            <span>${(jogador.estatisticas.RC / jogador.rodadas || 0).toFixed(2)}</span>
                        </div>
                    </div>
                    
                    <div class="estatisticas-item">
                        <h6><i class="fas fa-chart-line text-primary"></i> Varia√ß√£o de Posi√ß√£o (VP)</h6>
                        <div class="d-flex justify-content-between">
                            <span>Varia√ß√£o atual:</span>
                            <span class="badge ${vpClass}">${vp}</span>
                        </div>
                        <div class="small text-muted">
                            Compara√ß√£o com a rodada anterior
                        </div>
                    </div>
                `;
                
            } catch (error) {
                console.error('Erro ao carregar estat√≠sticas:', error);
                elements.estatisticasConteudo.innerHTML = `
                    <div class="alert alert-danger">
                        <i class="fas fa-exclamation-triangle"></i> Erro ao carregar estat√≠sticas: ${error.message}
                    </div>
                `;
            } finally {
                hideLoading('estatisticas');
            }
        }
        
        async function carregarEstatisticasRodada() {
            const jogadorId = sessionStorage.getItem('jogadorSelecionadoId');
            const jogadorNome = sessionStorage.getItem('jogadorSelecionadoNome');
            const rodadaNum = elements.selectRodadaEstatisticas.value;
            
            if (!jogadorId) {
                alert('Por favor, selecione um jogador primeiro.');
                return;
            }
            
            if (!rodadaNum) {
                alert('Por favor, selecione uma rodada.');
                return;
            }
            
            showLoading('estatisticas');
            
            try {
                const response = await fetch(`${API_BASE}/api/estatisticas/jogador/${jogadorId}/rodada/${rodadaNum}`);
                if (!response.ok) throw new Error(`HTTP ${response.status}`);
                
                const data = await response.json();
                
                const estatisticas = data.estatisticas;
                
                // Calcular VP para esta rodada
                const posicaoAtual = data.posicao_atual || '?';
                const posicaoAnterior = data.posicao_anterior || '?';
                let vp = '-';
                
                if (posicaoAnterior !== '?' && posicaoAtual !== '?' && rodadaNum > 1) {
                    const diff = posicaoAnterior - posicaoAtual;
                    if (diff > 0) {
                        vp = `+${diff}`;
                    } else if (diff < 0) {
                        vp = `${diff}`;
                    } else {
                        vp = '0';
                    }
                }
                
                const vpClass = getVPClass(vp).replace('badge-', '');
                
                // Renderizar estat√≠sticas da rodada
                elements.estatisticasConteudo.innerHTML = `
                    <div class="text-center mb-4">
                        <div class="display-4 text-primary">Rodada ${rodadaNum}</div>
                        <h5>Estat√≠sticas do Jogador</h5>
                    </div>
                    
                    <div class="row text-center mb-4">
                        <div class="col-4">
                            <div class="display-6">${data.pontos || 0}</div>
                            <div class="text-muted">Pontos</div>
                        </div>
                        <div class="col-4">
                            <div class="display-6">${posicaoAtual}¬∫</div>
                            <div class="text-muted">Posi√ß√£o</div>
                        </div>
                        <div class="col-4">
                            <div class="display-6">${vp}</div>
                            <div class="text-muted">VP</div>
                        </div>
                    </div>
                    
                    <div class="estatisticas-item">
                        <h6><i class="fas fa-star text-warning"></i> Placar Exato (PE)</h6>
                        <div class="d-flex justify-content-between">
                            <span>Total na rodada:</span>
                            <span class="badge badge-pe">${estatisticas.pe || 0}</span>
                        </div>
                    </div>
                    
                    <div class="estatisticas-item">
                        <h6><i class="fas fa-check-circle text-success"></i> Resultado Correto (RC)</h6>
                        <div class="d-flex justify-content-between">
                            <span>Total na rodada:</span>
                            <span class="badge badge-rc">${estatisticas.rc || 0}</span>
                        </div>
                    </div>
                    
                    <div class="estatisticas-item">
                        <h6><i class="fas fa-chart-line text-primary"></i> Varia√ß√£o de Posi√ß√£o</h6>
                        <div class="d-flex justify-content-between">
                            <span>Varia√ß√£o:</span>
                            <span class="badge ${vpClass}">${vp}</span>
                        </div>
                        <div class="small text-muted">
                            ${posicaoAnterior !== '?' ? `Posi√ß√£o anterior: ${posicaoAnterior}¬∫` : 'Primeira rodada'}
                        </div>
                    </div>
                    
                    <div class="estatisticas-item">
                        <h6><i class="fas fa-gamepad"></i> Participa√ß√£o</h6>
                        <div class="d-flex justify-content-between">
                            <span>Palpites realizados:</span>
                            <span>${data.palpites_feitos || 0}</span>
                        </div>
                        <div class="d-flex justify-content-between">
                            <span>Jogos totais:</span>
                            <span>${data.total_jogos || 0}</span>
                        </div>
                        <div class="d-flex justify-content-between">
                            <span>Participa√ß√£o:</span>
                            <span>${data.participacao_percentual || 0}%</span>
                        </div>
                    </div>
                `;
                
            } catch (error) {
                console.error('Erro ao carregar estat√≠sticas da rodada:', error);
                elements.estatisticasConteudo.innerHTML = `
                    <div class="alert alert-danger">
                        <i class="fas fa-exclamation-triangle"></i> Erro ao carregar estat√≠sticas: ${error.message}<br>
                        <small>Certifique-se de que o jogador participou desta rodada e que a rodada j√° foi calculada.</small>
                    </div>
                `;
            } finally {
                hideLoading('estatisticas');
            }
        }
        
        // Fun√ß√µes de c√°lculo de VP
        function calcularVP(item) {
            return item.vp || '-';
        }
        
        function calcularVPRodada(item, rodadaNum) {
            if (rodadaNum <= 1) {
                return '-';
            }
            return item.vp || '-';
        }
        
        function getVPClass(vp) {
            if (vp === '-') return 'badge-vp-zero';
            if (vp.startsWith('+')) return 'badge-vp-positive';
            if (vp.startsWith('-')) return 'badge-vp-negative';
            if (vp === '0') return 'badge-vp-zero';
            return 'badge-vp';
        }
        
        // Fun√ß√µes para cores das linhas
        function getRowClass(position) {
            if (position === 1) return 'row-gold';
            if (position === 2) return 'row-silver';
            if (position === 3) return 'row-bronze';
            if (position === 4) return 'row-fourth';
            if (position === 5) return 'row-pos-5';
            if (position === 6) return 'row-pos-6';
            if (position === 7) return 'row-pos-7';
            if (position === 8) return 'row-pos-8';
            if (position === 9) return 'row-pos-9';
            if (position === 10) return 'row-pos-10';
            if (position === 11) return 'row-pos-11';
            if (position === 12) return 'row-pos-12';
            if (position === 13) return 'row-pos-13';
            if (position === 14) return 'row-pos-14';
            if (position === 15) return 'row-pos-15';
            
            // Para posi√ß√µes acima de 15, ciclo entre os √∫ltimos 5 tons
            if (position <= 20) return `row-pos-${10 + (position % 5)}`;
            
            return 'row-pos-default';
        }
        
        // Inicializar auto-refresh
        let autoRefreshInterval = null;
    </script>
</body>
</html>
