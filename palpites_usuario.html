<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Palpites e Pontua√ß√£o</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <!-- Pako.js para descompress√£o Gzip -->
    <script src="https://cdn.jsdelivr.net/npm/pako@2.1.0/dist/pako.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; 
            background: #f5f5f7; color: #333; line-height: 1.6; padding: 20px; 
        }
        .container { 
            max-width: 800px; margin: 0 auto; background: white; border-radius: 16px; 
            overflow: hidden; box-shadow: 0 10px 30px rgba(0,0,0,0.1); 
        }
        header { 
            background: linear-gradient(135deg, #007aff 0%, #0056cc 100%); 
            color: white; padding: 25px; text-align: center; 
        }
        h1 { font-size: 24px; margin-bottom: 8px; font-weight: 700; }
        .subtitle { font-size: 14px; opacity: 0.9; }
        .user-info { padding: 20px; background: #f8f9fa; border-bottom: 1px solid #e0e0e0; }
        .user-name { font-size: 18px; font-weight: 600; margin-bottom: 5px; }
        .user-id { font-size: 13px; color: #666; }
        .select-container { padding: 20px; }
        .custom-select { position: relative; width: 100%; }
        select { 
            width: 100%; padding: 15px 20px; font-size: 16px; border: 2px solid #e0e0e0; 
            border-radius: 12px; background: white; cursor: pointer; transition: all 0.3s;
            appearance: none; -webkit-appearance: none;
        }
        select:focus { border-color: #007aff; outline: none; }
        .rodada-resumo { 
            padding: 25px; background: linear-gradient(135deg, #28a745 0%, #1e7e34 100%); 
            color: white; text-align: center; 
        }
        .rodada-titulo { font-size: 20px; font-weight: 700; margin-bottom: 20px; }
        .stats-grid { 
            display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; margin-top: 15px; 
        }
        .stat-card { 
            background: rgba(255, 255, 255, 0.15); padding: 15px; border-radius: 10px; 
            backdrop-filter: blur(10px);
        }
        .stat-value { display: block; font-size: 24px; font-weight: 700; margin-bottom: 5px; }
        .stat-label { font-size: 12px; opacity: 0.9; text-transform: uppercase; letter-spacing: 0.5px; }
        .jogos-container { padding: 20px; }
        .jogos-titulo { 
            display: flex; justify-content: space-between; align-items: center;
            margin-bottom: 20px; padding-bottom: 10px; border-bottom: 1px solid #e0e0e0;
        }
        .jogos-titulo span:first-child { font-size: 18px; font-weight: 600; }
        #contadorJogos { font-size: 14px; color: #666; }
        .jogos-lista { margin-top: 15px; }
        .jogo-card { 
            background: white; border: 1px solid #e0e0e0; border-radius: 12px; padding: 20px; 
            margin-bottom: 15px; position: relative; transition: transform 0.2s, box-shadow 0.2s;
        }
        .jogo-card:hover { 
            transform: translateY(-2px); box-shadow: 0 5px 15px rgba(0,0,0,0.1); 
        }
        .jogo-card.pd { border-left: 4px solid #dc3545; }
        .pd-badge { 
            position: absolute; top: 15px; right: 15px; background: #dc3545; color: white; 
            padding: 4px 10px; border-radius: 4px; font-size: 11px; font-weight: bold; 
            text-transform: uppercase;
        }
        .placares-container { 
            display: grid; grid-template-columns: 1fr auto 1fr; gap: 20px; align-items: center; 
            margin-bottom: 15px; 
        }
        .placar-box { text-align: center; }
        .placar-label { font-size: 11px; color: #666; margin-bottom: 5px; text-transform: uppercase; }
        .placar-valor { font-size: 20px; font-weight: 700; }
        .placar-real { color: #28a745; }
        .placar-palpite { color: #007aff; }
        .pontos-container { 
            display: flex; justify-content: space-between; align-items: center; 
            margin-top: 15px; padding-top: 15px; border-top: 1px solid #f0f0f0;
        }
        .pontos { font-size: 20px; font-weight: 700; color: #28a745; }
        .acertos-container { display: flex; gap: 5px; flex-wrap: wrap; }
        .badge { 
            padding: 6px 12px; border-radius: 6px; font-size: 11px; font-weight: 600; 
            text-transform: uppercase; 
        }
        .badge.pe { background: #28a745; color: white; }
        .badge.rc { background: #007aff; color: white; }
        .badge.gm { background: #6c757d; color: white; }
        .badge.gv { background: #6c757d; color: white; }
        .badge.pd { background: #dc3545; color: white; }
        .loading { 
            text-align: center; padding: 60px 20px; color: #666; 
            display: flex; flex-direction: column; align-items: center; gap: 15px;
        }
        .loading-spinner {
            width: 40px; height: 40px; border: 4px solid #f3f3f3;
            border-top: 4px solid #007aff; border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        .badge-label {
            display: block;
            font-size: 10px;
            opacity: 0.9;
            margin-top: 2px;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .error { 
            text-align: center; padding: 40px 20px; color: #dc3545; background: #f8d7da;
            border-radius: 10px; border: 1px solid #f5c6cb;
        }
        .vs-separator {
            color: #666;
            font-size: 12px;
            margin: 0 5px;
        }
        @media (max-width: 600px) {
            .stats-grid { grid-template-columns: repeat(2, 1fr); }
            .placares-container { grid-template-columns: 1fr; gap: 15px; }
            .placares-container > div:nth-child(2) { display: none; }
            .jogo-card { padding: 15px; }
            .badge { padding: 4px 8px; font-size: 10px; }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üìä Palpites e Pontua√ß√£o</h1>
            <div class="subtitle" id="subtitle">Carregando dados do usu√°rio...</div>
        </header>
        
        <div class="user-info" id="userInfo">
            <div class="user-name" id="userName">Carregando...</div>
            <div class="user-id" id="userId">ID: --</div>
        </div>
        
        <div class="select-container">
            <div class="custom-select">
                <select id="rodadaSelect" onchange="mudarRodada()">
                    <option value="">Carregando rodadas...</option>
                </select>
            </div>
        </div>
        
        <div class="rodada-resumo" id="rodadaResumo" style="display: none;">
            <div class="rodada-titulo" id="rodadaTitulo">Rodada --</div>
            <div class="stats-grid">
                <div class="stat-card">
                    <span class="stat-value" id="totalPontos">0</span>
                    <span class="stat-label">Pontos</span>
                </div>
                <div class="stat-card">
                    <span class="stat-value" id="jogosPalpitados">0</span>
                    <span class="stat-label">Palpitados</span>
                </div>
                <div class="stat-card">
                    <span class="stat-value" id="totalJogos">0</span>
                    <span class="stat-label">Total Jogos</span>
                </div>
                <div class="stat-card">
                    <span class="stat-value" id="jogosComPlacar">0</span>
                    <span class="stat-label">Com Placar</span>
                </div>
                <div class="stat-card">
                    <span class="stat-value" id="totalPE">0</span>
                    <span class="stat-label">PE</span>
                </div>
                <div class="stat-card">
                    <span class="stat-value" id="temPD">N√£o</span>
                    <span class="stat-label">PD</span>
                </div>
            </div>
        </div>
        
        <div class="jogos-container">
            <div class="jogos-titulo">
                <span>Jogos da rodada</span>
                <span id="contadorJogos">0 jogos palpitados</span>
            </div>
            <div id="loading" class="loading">
                <div class="loading-spinner"></div>
                <div>Carregando jogos...</div>
            </div>
            <div id="jogosLista" class="jogos-lista"></div>
            <div id="error" class="error" style="display: none;"></div>
        </div>
    </div>

    <script>
        // Vari√°veis globais
        let appData = {};
        let rodadasDisponiveis = [];
        let rodadasDados = {};
        let rodadaAtualNum = null;
        let userId = null;
        
        // Mapeamento de siglas para nomes completos
        const acertoLabels = {
            'PE': 'Placar Exato',
            'RC': 'Resultado Correto',
            'GM': 'Gols Mandante',
            'GV': 'Gols Visitante',
            'PD': 'Pontua√ß√£o Dobrada'
        };
        
        // Inicializa√ß√£o
        document.addEventListener('DOMContentLoaded', function() {
            if (window.Telegram && Telegram.WebApp) {
                Telegram.WebApp.expand();
                Telegram.WebApp.enableClosingConfirmation();
                Telegram.WebApp.setBackgroundColor('#f5f5f7');
                Telegram.WebApp.setHeaderColor('#007aff');
            }
            
            carregarDadosDaURL();
        });
        
        function carregarDadosDaURL() {
            try {
                const urlParams = new URLSearchParams(window.location.search);
                const dataParam = urlParams.get('data');
                
                if (!dataParam) {
                    mostrarErro('‚ùå Dados n√£o encontrados na URL');
                    return;
                }
                
                console.log('=== CARREGANDO DADOS DA URL ===');
                console.log('Tamanho dos dados:', dataParam.length, 'caracteres');
                
                // Tenta descomprimir com Gzip
                let dados;
                try {
                    dados = descomprimirGzip(dataParam);
                    console.log('‚úÖ Descompress√£o Gzip bem-sucedida');
                } catch (gzipError) {
                    console.warn('‚ö†Ô∏è Falha na descompress√£o Gzip, tentando Base64...');
                    try {
                        const safeBase64 = dataParam
                            .replace(/\-/g, '+')
                            .replace(/\_/g, '/')
                            .padEnd(dataParam.length + (4 - dataParam.length % 4) % 4, '=');
                        const jsonString = atob(safeBase64);
                        dados = JSON.parse(jsonString);
                    } catch (error) {
                        mostrarErro('Erro ao processar dados: ' + error.message);
                        return;
                    }
                }
                
                console.log('Dados processados:', dados);
                
                // Valida dados
                if (!dados || !dados.t) {
                    throw new Error('Formato de dados inv√°lido ou incompleto');
                }
                
                appData = dados;
                userId = appData.u?.id || appData.u?.tid;
                
                // Preenche informa√ß√µes do usu√°rio
                document.getElementById('userName').textContent = appData.u?.n || 'Usu√°rio desconhecido';
                document.getElementById('userId').textContent = `ID: ${appData.u?.id || '--'} | Telegram: ${appData.u?.tid || '--'}`;
                document.getElementById('subtitle').textContent = `Usu√°rio: ${appData.u?.n || '--'}`;
                
                // Armazena dados das rodadas
                rodadasDisponiveis = appData.rd || [];
                rodadasDados = {};
                
                // CORRE√á√ÉO: Primeira rodada j√° vem completa
                if (appData.ra && appData.rdc) {
                    rodadasDados[appData.ra] = appData.rdc;
                    rodadaAtualNum = appData.ra;
                    console.log(`‚úÖ Rodada atual: ${rodadaAtualNum} com ${appData.rdc.jogos?.length || 0} jogos`);
                }
                
                console.log('Rodadas dispon√≠veis:', rodadasDisponiveis.length);
                
                // Popula o select com as rodadas
                popularSelectRodadas();
                
                // Exibe a primeira rodada dispon√≠vel
                if (rodadaAtualNum) {
                    selecionarRodada(rodadaAtualNum);
                } else if (rodadasDisponiveis.length > 0) {
                    selecionarRodada(rodadasDisponiveis[0].n);
                }
                
                // Esconde loading
                document.getElementById('loading').style.display = 'none';
                console.log('‚úÖ Dados carregados com sucesso!');
                
            } catch (error) {
                console.error('‚ùå Erro ao carregar dados:', error);
                mostrarErro(`Erro ao processar dados: ${error.message}`);
            }
        }
        
        function descomprimirGzip(base64Data) {
            try {
                // URL-safe Base64 para padr√£o
                const safeBase64 = base64Data
                    .replace(/\-/g, '+')
                    .replace(/\_/g, '/')
                    .padEnd(base64Data.length + (4 - base64Data.length % 4) % 4, '=');
                
                const binaryString = atob(safeBase64);
                
                if (binaryString.length === 0) {
                    throw new Error('String bin√°ria vazia');
                }
                
                const bytes = new Uint8Array(binaryString.length);
                for (let i = 0; i < binaryString.length; i++) {
                    bytes[i] = binaryString.charCodeAt(i);
                }
                
                // Verifica se √© Gzip v√°lido
                const isGzip = bytes[0] === 0x1F && bytes[1] === 0x8B;
                
                if (isGzip) {
                    const decompressed = pako.inflate(bytes, { to: 'string' });
                    return JSON.parse(decompressed);
                } else {
                    // Tenta como JSON direto
                    return JSON.parse(binaryString);
                }
            } catch (error) {
                console.error('Erro na descompress√£o:', error);
                throw error;
            }
        }
        
        function popularSelectRodadas() {
            const select = document.getElementById('rodadaSelect');
            select.innerHTML = '';
            
            if (rodadasDisponiveis.length === 0) {
                const option = document.createElement('option');
                option.value = '';
                option.textContent = 'Nenhuma rodada dispon√≠vel';
                select.appendChild(option);
                return;
            }
            
            rodadasDisponiveis.forEach(rodada => {
                const option = document.createElement('option');
                option.value = rodada.n;
                
                let texto = `Rodada ${rodada.n}`;
                
                // Adiciona informa√ß√µes da rodada
                if (rodada.p !== undefined) texto += ` ‚Ä¢ ${rodada.p} pts`;
                if (rodada.s === 'fechada') texto += ' ‚Ä¢ üîí';
                if (rodada.jc !== undefined && rodada.jt !== undefined) {
                    texto += ` ‚Ä¢ üìä ${rodada.jc}/${rodada.jt}`;
                }
                
                option.textContent = texto;
                select.appendChild(option);
            });
            
            // Seleciona a rodada atual
            if (rodadaAtualNum) {
                select.value = rodadaAtualNum;
            }
        }
        
        function selecionarRodada(numeroRodada) {
            console.log(`Selecionando rodada ${numeroRodada}...`);
            
            // CORRE√á√ÉO: Limpa o cache para for√ßar recarregamento
            if (rodadasDados[numeroRodada]) {
                // Usa dados do cache
                rodadaAtualNum = numeroRodada;
                document.getElementById('rodadaSelect').value = numeroRodada;
                exibirResumoRodada(rodadasDados[numeroRodada]);
                exibirJogosRodada(rodadasDados[numeroRodada]);
            } else {
                // Se n√£o temos dados, carrega do bot
                carregarRodadaDoBot(numeroRodada);
            }
        }
        
        function exibirResumoRodada(rodada) {
            const resumo = document.getElementById('rodadaResumo');
            resumo.style.display = 'block';
            
            const rodadaNum = rodada.num || rodadaAtualNum;
            document.getElementById('rodadaTitulo').textContent = `Rodada ${rodadaNum}`;
            
            // CORRE√á√ÉO: Calcula estat√≠sticas corretamente
            const jogos = rodada.jogos || [];
            const totalJogos = rodada.jt || jogos.length;
            
            // Jogos palpitados (com palpite n√£o vazio)
            const jogosPalpitados = jogos.filter(j => 
                j.palpite && j.palpite !== '0x0' && j.palpite !== ''
            ).length;
            
            // Jogos com placar real (n√£o √© ?x?)
            const jogosComPlacar = jogos.filter(j => 
                j.placar_real && j.placar_real !== '?x?'
            ).length;
            
            // Total de PE (Placares Exatos)
            const totalPE = jogos.filter(j => 
                j.ac && j.ac.includes('PE')
            ).length;
            
            // Tem PD (Pontua√ß√£o Dobrada usada)
            const temPD = jogos.some(j => j.pd) || rodada.pd_usada || false;
            
            // CORRE√á√ÉO: Total de pontos deve vir do bot, mas calculamos se necess√°rio
            const totalPontos = rodada.tp || jogos.reduce((sum, j) => sum + (j.pts || 0), 0);
            
            // Atualiza estat√≠sticas
            document.getElementById('totalPontos').textContent = totalPontos;
            document.getElementById('jogosPalpitados').textContent = jogosPalpitados;
            document.getElementById('totalJogos').textContent = totalJogos; // AGORA: total REAL de jogos
            document.getElementById('jogosComPlacar').textContent = jogosComPlacar;
            document.getElementById('totalPE').textContent = totalPE;
            document.getElementById('temPD').textContent = temPD ? 'Sim' : 'N√£o';
        }
        
        function exibirJogosRodada(rodada) {
            const container = document.getElementById('jogosLista');
            let jogos = rodada.jogos || [];
            
            console.log(`Exibindo ${jogos.length} jogos da rodada ${rodada.num || rodadaAtualNum}`);
            
            // Limpa container
            container.innerHTML = '';
            
            // CORRE√á√ÉO: Calcula contagem correta
            const totalJogos = rodada.jt || jogos.length;
            const jogosPalpitados = jogos.filter(j => 
                j.palpite && j.palpite !== '0x0' && j.palpite !== ''
            ).length;
            
            document.getElementById('contadorJogos').textContent = 
                `${jogosPalpitados}/${totalJogos} jogos palpitados`;
            
            if (jogos.length === 0) {
                container.innerHTML = `
                    <div class="jogo-card" style="text-align: center; color: #666;">
                        <div style="font-size: 48px; margin-bottom: 10px;">üì≠</div>
                        <div style="font-weight: 600; margin-bottom: 5px;">Nenhum palpite nesta rodada</div>
                        <div style="font-size: 14px;">Voc√™ n√£o fez palpites nos jogos desta rodada</div>
                    </div>
                `;
                return;
            }
            
            // CORRE√á√ÉO: Mant√©m ordem original do bot (n√£o reordena)
            // Se os jogos t√™m ordem definida, usa-a, sen√£o mant√©m como veio
            
            // Cria cards para cada jogo
            jogos.forEach((jogo, index) => {
                const div = document.createElement('div');
                div.className = `jogo-card ${jogo.pd ? 'pd' : ''}`;
                
                // Formata data/hora
                let dataFormatada = '';
                if (jogo.dh) {
                    try {
                        const data = new Date(jogo.dh);
                        if (!isNaN(data)) {
                            dataFormatada = data.toLocaleDateString('pt-BR', {
                                day: '2-digit',
                                month: '2-digit',
                                hour: '2-digit',
                                minute: '2-digit'
                            });
                        }
                    } catch (e) {
                        console.warn('Erro ao formatar data:', e);
                    }
                }
                
                let html = '';
                
                // Badge de PD (Pontua√ß√£o Dobrada)
                if (jogo.pd) {
                    html += '<div class="pd-badge">Ponto Dobrado</div>';
                }
                
                // T√≠tulo do jogo e data - CORRE√á√ÉO: Usa nomes completos
                const mandante = jogo.m || jogo.mandante || 'Time A';
                const visitante = jogo.v || jogo.visitante || 'Time B';
                
                html += `
                    <div style="margin-bottom: 15px;">
                        <div style="font-weight: 600; font-size: 16px; margin-bottom: 5px; display: flex; align-items: center;">
                            <span>${mandante}</span>
                            <span class="vs-separator">vs</span>
                            <span>${visitante}</span>
                        </div>
                        ${dataFormatada ? `
                            <div style="font-size: 12px; color: #666;">
                                <span>üìÖ</span> ${dataFormatada}
                            </div>
                        ` : ''}
                    </div>
                `;
                
                // Placar real vs palpite
                const placarReal = jogo.pr || jogo.placar_real || '?x?';
                const palpite = jogo.pal || jogo.palpite || '0x0';
                
                html += `
                    <div class="placares-container">
                        <div class="placar-box">
                            <div class="placar-label">Placar Real</div>
                            <div class="placar-valor placar-real">
                                ${placarReal}
                            </div>
                        </div>
                        <div style="font-size: 20px; color: #ccc; font-weight: 300;">‚Üí</div>
                        <div class="placar-box">
                            <div class="placar-label">Seu Palpite</div>
                            <div class="placar-valor placar-palpite">
                                ${palpite}
                            </div>
                        </div>
                    </div>
                `;
                
                // CORRE√á√ÉO: Pontua√ß√£o e acertos com labels explicativos
                const pontos = jogo.pts || jogo.pontos || 0;
                const acertos = jogo.ac || [];
                
                html += `
                    <div class="pontos-container">
                        <div class="pontos">${pontos} pontos</div>
                        <div class="acertos-container">
                `;
                
                // CORRE√á√ÉO: Badges com nomes completos
                if (acertos.length > 0) {
                    acertos.forEach(acerto => {
                        const tipo = acerto.toUpperCase();
                        const label = acertoLabels[tipo] || tipo;
                        html += `
                            <span class="badge ${tipo.toLowerCase()}" title="${label}">
                                ${tipo}
                                <span class="badge-label">${label}</span>
                            </span>
                        `;
                    });
                } else {
                    html += `<span style="font-size: 12px; color: #666;">Sem acertos</span>`;
                }
                
                // CORRE√á√ÉO: Adiciona explica√ß√£o da pontua√ß√£o se for PE
                if (acertos.includes('PE')) {
                    html += `
                        <div style="font-size: 12px; color: #666; margin-top: 10px; padding: 8px; background: #f8f9fa; border-radius: 6px;">
                            <strong>Placar Exato:</strong> 14 pontos (inclui RC + GM + GV)
                        </div>
                    `;
                }
                
                html += `</div></div>`;
                
                div.innerHTML = html;
                container.appendChild(div);
            });
            
            // Esconde loading
            document.getElementById('loading').style.display = 'none';
        }
        
        function mudarRodada() {
            const select = document.getElementById('rodadaSelect');
            const numeroRodada = parseInt(select.value);
            
            if (!isNaN(numeroRodada)) {
                console.log(`Mudando para rodada ${numeroRodada}`);
                
                // CORRE√á√ÉO IMPORTANTE: Fecha e abre nova WebApp para evitar problemas de cache
                if (window.Telegram?.WebApp) {
                    // Fecha a WebApp atual
                    Telegram.WebApp.close();
                    
                    // Em uma implementa√ß√£o real, o bot receberia o comando
                    // e abriria uma nova WebApp com apenas os dados da rodada selecionada
                    
                    // Por enquanto, apenas mostra mensagem
                    setTimeout(() => {
                        selecionarRodada(numeroRodada);
                    }, 100);
                } else {
                    selecionarRodada(numeroRodada);
                }
            }
        }
        
        function carregarRodadaDoBot(numeroRodada) {
            console.log(`Solicitando rodada ${numeroRodada} do bot...`);
            
            // Mostra loading
            document.getElementById('loading').style.display = 'flex';
            document.getElementById('jogosLista').innerHTML = '';
            
            // CORRE√á√ÉO: Em produ√ß√£o, isso deve fechar a WebApp e pedir ao bot
            // para abrir uma nova com apenas os dados da rodada selecionada
            
            // Simula√ß√£o de carregamento
            setTimeout(() => {
                document.getElementById('loading').style.display = 'none';
                document.getElementById('jogosLista').innerHTML = `
                    <div class="jogo-card" style="text-align: center;">
                        <div style="font-size: 48px; margin-bottom: 15px;">üîÑ</div>
                        <div style="font-weight: 600; margin-bottom: 10px;">Rodada ${numeroRodada}</div>
                        <div style="color: #666; margin-bottom: 15px;">
                            Para ver os detalhes desta rodada, voc√™ precisa:
                        </div>
                        <div style="font-size: 14px; color: #999; background: #f8f9fa; padding: 15px; border-radius: 8px;">
                            <strong>Solu√ß√£o Correta:</strong><br>
                            1. Fechar esta janela<br>
                            2. No bot, usar comando para ver rodada ${numeroRodada}<br>
                            3. O bot enviar√° apenas os dados desta rodada
                        </div>
                    </div>
                `;
                
                // Mostra estat√≠sticas vazias
                document.getElementById('rodadaResumo').style.display = 'block';
                document.getElementById('rodadaTitulo').textContent = `Rodada ${numeroRodada}`;
                document.getElementById('totalPontos').textContent = '--';
                document.getElementById('jogosPalpitados').textContent = '--';
                document.getElementById('totalJogos').textContent = '--';
                document.getElementById('jogosComPlacar').textContent = '--';
                document.getElementById('totalPE').textContent = '--';
                document.getElementById('temPD').textContent = '--';
            }, 1000);
        }
        
        function mostrarErro(mensagem) {
            console.error('Mostrando erro:', mensagem);
            
            document.getElementById('loading').style.display = 'none';
            
            const errorDiv = document.getElementById('error');
            errorDiv.style.display = 'block';
            errorDiv.innerHTML = `
                <div style="font-size: 48px; margin-bottom: 15px;">‚ùå</div>
                <div style="font-weight: 600; margin-bottom: 10px;">Erro ao carregar</div>
                <div style="margin-bottom: 15px;">${mensagem}</div>
                <div style="font-size: 14px; color: #666;">
                    Tente novamente ou entre em contato com o administrador.
                </div>
            `;
        }
    </script>
</body>
</html>
